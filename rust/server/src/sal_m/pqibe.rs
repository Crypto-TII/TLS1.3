//! Ducas et al. lattice-based IBE
// For code to set up TA and issue secret keys, contact me - michael.scott@tii.ae

extern crate mcore;

use mcore::sha3;
use mcore::sha3::SHA3;

const PRIME: u32 = 0x8020001;
const ONE: u32 =  0x7C1FFE1;
const R2MODP: u64 =  0xFA047E;
const ND: u64 =  0x801FFFF;
const LIM: usize = 64; // could be reduced 128, 64?
const LGN: usize = 10;
const DEGREE: usize = 1<<LGN;
const UBITS: usize = 28;
const VBITS: usize = 3;
const ULEN: usize = UBITS*DEGREE/8;
const VLEN: usize = VBITS*DEGREE/8;
const DLQ: u32 = ((DEGREE/LIM) as u32)*PRIME;

const INV : u32 = 0x400000;
const INVPR: u32 = 0x60ff677;
const ROOTS:  [u32; 1024] = [0x7c1ffe1,0x6362708,0x45401e8,0x60207e,0x272355d,0x233006,0x9d6d36,0x3d02f9a,0x771d6e8,0x661ea3e,0x1b2a2f,0x487c668,0x56ec3e9,0x563ea0e,0x71ef93f,0x46af7ca,0x431e77b,0x219e6a7,0x33e88d8,0x68edbb5,0x587f588,0x77d7677,0x6ef458c,0x33d0371,0x74055eb,0xad4ed7,0x52224a3,0x67ab958,0x54281c9,0x1e39f16,0x28403d4,0x6fff0a3,0x4173ac0,0x50139dd,0x7594613,0x715165a,0x1dda5b6,0x22a9f4f,0x4063386,0x3da7712,0x1878088,0x3e26ff1,0x684d588,0x111c526,0x5723b3,0x41546ba,0x58f9bee,0x20e749c,0x6575666,0x708d971,0x7048652,0x5e6d01b,0x661ab01,0xb5c31c,0x767e192,0x5bc96f,0x7c4edaf,0x3be6cea,0x3355c75,0x1b35ff7,0x7a0a781,0x7d3ca83,0x2db976e,0x36881de,0x5fbebb3,0x47b73cc,0x6975af0,0x610bf6a,0x740a9dd,0x117a783,0x6d75314,0x260368f,0x25dd6f9,0x118eb2,0x731d94b,0x657e164,0x7eb3daa,0xc97fb6,0x502d1ab,0x13418a0,0x3c2363d,0x54d8e23,0x1032621,0x2e8905a,0x5fdabc8,0x780c630,0x2474ee,0x42fae99,0x186acc9,0x497adcb,0x2042f33,0x3262a8f,0x7cc5a40,0x203d094,0x4ee931e,0x4ed448b,0x1115636,0x1c18918,0x1d828b,0x7bf1c61,0x12b3ab6,0x2d57990,0x30f45,0x7649bc5,0x6a2146,0x8c800c,0x46fab1f,0x7741b5d,0xe32f75,0x3d0e352,0xb8d0c6,0x2cc08a,0x2e0a850,0x1adfb1f,0x5e1e299,0x8a5028,0x648ec62,0x581adad,0x53023c0,0x1b503f2,0x7826bb5,0xb3f6f5,0x351c21e,0x4991a0d,0x1147223,0x40def85,0x6be2de0,0x387163,0x4bb22e6,0x2eba55e,0x3fadf24,0x5609ebe,0x1dfdd31,0x53fbbe,0x5094fbf,0x91104d,0x719a691,0x196daa3,0x6c3179d,0x7ebf37f,0x239bbec,0x4fb5764,0x6ed689b,0x3a0fdce,0x239175e,0x5acd5ef,0x1bfa82b,0x5143035,0x294f431,0x270683,0x3625660,0xd159ba,0x32633e4,0x41d0706,0x1fb0544,0x5e75b4,0x65d50a7,0x2d042de,0x5badff,0x551c2bf,0x735c056,0x5f8428f,0x4c9e9f6,0x821991,0x1d8cf36,0x6ca4a8b,0x11f2c27,0x313d03c,0x1996452,0x2107370,0x5d2e4a9,0x4612494,0x4097732,0x282aaeb,0x2d38f9f,0x6ba7a8e,0x3d59450,0x6b85240,0x1cdf1e4,0x65bbec8,0xdb39f2,0x451971c,0x7f03bd2,0x6e4a4d0,0x74f8d97,0x7035ad9,0x695321d,0x6c2493,0x725b0fb,0x1096e3e,0x71681b2,0x57647be,0x6bff3be,0x297dc11,0x7c01a06,0x6bae8c8,0x5f3ec37,0x6a06a45,0x4f046d3,0x6b35f00,0x4d1c9e7,0x53a6282,0x3bd9efb,0x6057dd7,0x65d048c,0x2cd242d,0x450924c,0x21a9bb6,0x2ed604c,0x6b0e157,0x630b785,0x68e451b,0x50a0bbe,0x42dde0e,0x6ce8a37,0x5ceee9,0x78c51a3,0x7187991,0x244f75b,0x736d41,0xea6968,0x6f0d951,0x741fe2f,0x7d8e6a3,0x26a2143,0x35d30e8,0x39668,0x3052302,0x3920332,0x5f3debe,0x6e9b06,0x2839909,0x5224455,0x5305ebe,0x1ed7bfd,0x626943a,0x6a0b01e,0x106f1d5,0x8e8e2e,0x4cd1bff,0x96b09e,0x5fc992a,0x27d655b,0x100c33a,0x51bbfe3,0x5ead0ea,0xa6b1fb,0x41869df,0x7f9cd9a,0x199daa,0x26656a1,0x1c9185,0x2c429ea,0x1076c9e,0x4f874ab,0x4488c7d,0x55c6eac,0x5b8750f,0x5d18a95,0x3fee28b,0x665c466,0x2ce7927,0x671042,0x7806ab2,0x3f53bcd,0x4780c89,0x7096f1d,0x238017e,0x56c858c,0x6ef3fce,0x6809f09,0x32c79f5,0x4f386b,0x32313aa,0x8ffe22,0x31a2aec,0x65769df,0x2102bb7,0xaea89e,0x24000fc,0x48972af,0x707f6f0,0x7d39d84,0x24782dd,0x6c11eff,0x20d8ebf,0x7420bf9,0x1e6b929,0x2e7d2c8,0x482cfc1,0x645d2e5,0x44d9435,0x5e3ba72,0x3910df,0x132a89d,0x504162d,0x3f607ba,0x94ed1d,0x7cbdd40,0x70d86ea,0x76e369a,0x5aa8d15,0x1948566,0x5ba66d4,0x1872901,0x67e2700,0x195af5d,0x4394e59,0x279e163,0x401a4b0,0x6914ba0,0x3a32be5,0x601b550,0x1412f99,0x961169,0x28cd9fa,0x3ba58ad,0x1ff88eb,0x36d9167,0x2c70d6f,0x1c5d3dd,0x62a7022,0x5106f33,0x7891cd8,0x67d937,0x126ccb9,0x7d1244f,0x3fb2737,0x1a299e9,0xf1777b,0x637d472,0x2c70798,0x6c275f1,0x5acd1fa,0x486b52f,0x366a133,0x43f3bc6,0x47fb230,0x4be7ce8,0x4733305,0x75388a,0x64da47,0x3ce0fea,0x39bba0f,0x309fb0a,0x38b6b6d,0x22c3a83,0xdfc544,0x4824353,0x1070e76,0x39b82ea,0xb2416e,0x26a094c,0x6306ffc,0x4e11a8b,0x3c98963,0x44e68c3,0x7d1d519,0x44391c1,0x3dbb4bc,0x74e781c,0x717dc85,0x13fbff9,0x4e3c47,0x51f26f8,0x9a26d4,0x13c6214,0x6aaf4bd,0x34c2090,0x7d0b242,0x7752e34,0x5a4552d,0x1a149ea,0x5cb4845,0x246b6ad,0x7a24799,0x6c407a4,0x77ec983,0x16ba77c,0x497ad49,0x2ebe598,0x534231e,0x6c4f9a,0x3e0a073,0x1872622,0x62a6282,0x76f311d,0x7bdf999,0x689eecf,0x295e0df,0x14f3fdf,0x7076a0d,0x2be24ab,0x2da71fe,0x4f80a89,0x251e057,0x322e69a,0x16b2bbf,0x4ff5289,0x3f0e32d,0x16d527a,0x701e1ba,0x20c44cd,0x623e2e2,0x16002e9,0x579a9c7,0x10ce8db,0x6450074,0x455bc64,0x7d311bf,0x4dbfc29,0x59c8d4c,0x7543b60,0x12e5a94,0x3700305,0x5fcdf8,0x717918f,0x4940c85,0x189c0f8,0x9d944b,0x16ddc48,0x634fc61,0x593331f,0x263468f,0x31dc2c9,0x1f84ec6,0x70c419e,0x10d5691,0x2735f36,0x7480514,0x5ede7db,0x423b720,0x6c2692e,0x22904b,0x32b80de,0xbc4c03,0x2155403,0x687464f,0x3b84ebe,0x878c20,0x5f3741d,0x751f169,0x6188f1,0x6ae9086,0x14c446d,0xc057f7,0x3f9e770,0x7b50f01,0x6104f16,0x2579ffd,0x1671bb5,0x25ed079,0x45f06a5,0x8f792a,0x402218c,0x7ab1eec,0xf4c80,0x27fefa4,0x387d544,0x568a258,0x29da24e,0x20ee75b,0x6a74db8,0x44f51b0,0x14f9681,0x3bae8b,0x13420d5,0x27619a7,0x5864241,0xb2f50f,0x48d73de,0x7c2bab,0x49485f,0x46f8c7e,0x71d942a,0x4e7891c,0x62323d1,0x181d65c,0xc4b86f,0x4d0331b,0x7599b74,0x5896207,0x6cc77fa,0x54d4cbf,0x6129685,0x27c4625,0x9a510d,0x2cba43d,0x2ee86f9,0x69c06c3,0x9427e6,0x56e284b,0x2a34e16,0x12689d1,0x1b6aeba,0x7fd22a7,0x547a436,0x1ff185c,0x6351914,0x51c3532,0x286d9f1,0x864b5b,0x80716a,0x72cb23d,0x6679e95,0x534ee49,0x2497172,0x3c32234,0x323e3ec,0x7e6750a,0x3fdbf59,0xdea7bb,0x4ba2cdf,0x27fea89,0x4e69dc8,0x4781409,0x6a0415,0x31aedce,0x2db22c3,0x7c2f2f4,0xd78dcb,0x77b5521,0x472377,0xdf9f67,0x31647d5,0x1920ca,0x2ab9c6b,0x340c89d,0x321e9b0,0x476449e,0x4537447,0x4fd33ab,0x48f3087,0x4962f90,0x5f4a9b,0x5f0fba6,0x55a7b38,0x432f9ea,0x22cd9dc,0x524cdd1,0x3e10242,0x2b75ec3,0x79b098f,0x5bc685d,0xf8e66f,0x68cca72,0xa6c3c4,0x5244bcb,0x4ec557c,0x581e7b,0x462ca63,0x3070dc5,0x25fce06,0x78e740b,0x5fdfd60,0x437f083,0xffe489,0x6c6b517,0x411d983,0x3c9152c,0x41448e9,0x60833c3,0x71cf255,0x499c5d1,0x523caca,0x4e92636,0x13371a6,0x393d9da,0x608e9db,0xd25a16,0x56c2481,0x3e1e7f9,0x16ea093,0x2ebb28a,0x1d134b4,0x70ac086,0x3306cb,0x734053,0x6f31161,0x5cf70e5,0x5b31d29,0xa5fd3,0x2e4c16d,0x21c1e70,0x8ce7e3,0x58965c4,0x115764b,0x7e218d7,0x6481815,0x35f830a,0x6fad851,0x415cc9e,0x4667bad,0x67f23fb,0xcebc6a,0x69f7a10,0x496533,0x7114be2,0x2fa1f7,0x7545eb3,0x5799a9b,0x5b883d5,0x4db0d2b,0x30d0517,0x61a2d48,0x2f35fa3,0x4240c1,0x68e92f6,0x575ccf3,0x4933b25,0x56a20b7,0x55f7d7,0x1b6b755,0x78b329,0x3a746c2,0x7ca2fc5,0x7cb4f6f,0x7e2e2f0,0x79d3f10,0x7c204c1,0xea97ea,0x7fe039b,0x36602f8,0x562d036,0x4a3bcaf,0x717db8b,0x5027292,0x558cfb,0x169127f,0x56a7b81,0x438ed28,0x20bf27b,0x1797db7,0x10441d,0xf700c9,0x109bc1,0x6dfc58e,0x6a2fa19,0x4608c4a,0x5417c51,0x39be70f,0x68da436,0x5e9b14e,0x2ce412e,0xb6f71e,0x2e69e85,0x5c28ee0,0x7ecf45c,0x51d26f0,0x11442ac,0x17be9c6,0x48b5456,0x836963,0x756298e,0x376ae86,0xd43456,0x72a0d97,0x4bf4142,0xcefec6,0x6814369,0x5adf37f,0x55182d9,0x310b174,0x53e22dd,0xb1f8bd,0x2d0efee,0x55ea79c,0x364fb64,0x763976e,0x4a2eebf,0x2cc20ab,0x68d1634,0x2f67fa9,0x190e115,0x6462607,0x1af288f,0x4e4e393,0x271d707,0xb467f5,0x1c61455,0x3d3de48,0x6f81ed3,0xc8c13c,0x4b11854,0x624fe28,0x5b90ec9,0x201edfd,0x5d6f2b6,0x2b87a0a,0x222fcf,0x32607bc,0x6c30b15,0x22b6d7e,0xf8da4,0x74d2eb8,0x6d046e1,0x4d98a6b,0x27fd53,0x12662fd,0x6aa1fd6,0x498444a,0x6cd0adf,0x451a0d4,0x18f0606,0xcf045d,0x195e795,0x3afc84e,0x693d407,0x11aa1c6,0xb01416,0x7dfda83,0x6acb1cd,0x320d61e,0x82c022,0x11d4cbb,0x3acee56,0x5526958,0x34459b5,0x464554b,0x632b495,0x2cbea3,0x3ccf259,0xf643c5,0x6bfa1f,0x1d1d9b0,0x154db08,0x2523afc,0x437c34a,0x5072e17,0x122347d,0x34a3127,0x37b44b,0x6c08534,0x2aa5808,0x3afae59,0x445d921,0x2ab1de6,0x4d96d55,0x5431d,0x523dd2e,0x722f9d5,0x45734bb,0x6bc887f,0x25e1804,0x246af45,0x6768527,0x4585c73,0x64d365f,0x331e48c,0x614144b,0x939809,0x5b41f97,0x6fb4dff,0x3477273,0x1ea6539,0x3f338ec,0x8b6982,0x12ddbb2,0x7c30d5,0x7cd75be,0x55abc82,0xdaa31c,0xd76205,0x22a8473,0x75b80fb,0x679fc3,0x1e17971,0x4d24ffa,0x75c5862,0x557d559,0x74d22c6,0x8ca7ff,0x5991f9c,0x596145b,0x55a814,0x4f14d2a,0xd21cd,0x71a2d4d,0x5cbc7e8,0x2f29f4f,0x6a8e423,0x6811fd8,0x37db3f5,0x1905e43,0x1718e24,0x57df501,0x7aff1cc,0x3b3b3a6,0x18f7a26,0x13c210d,0x45f100b,0x6dc7596,0x6e97f37,0x48d4cc6,0x7f42bb5,0x1f899e9,0xfb9637,0x487f256,0x365863d,0x7597dd3,0xa58a45,0x729f6a4,0x5cb2199,0x17ae74c,0x7909c18,0x2b0b952,0xe0a171,0x693fc73,0x2b57c81,0x29b29b2,0x729b5e3,0x4edc9c,0x634c403,0x247701a,0x6eb82fc,0x2dde47e,0x311d474,0x24a7c70,0x4e015af,0x3ccf141,0x1993500,0x5fc84d5,0x507c2c3,0x2e110e8,0x311ecce,0x3c2471c,0x46b458f,0x16a5ee9,0x13b01df,0x1561ff8,0x38a77ef,0x7c75126,0x1ee8e7c,0x2a01a13,0x6d49243,0x2740959,0x5e3e5b5,0x165085e,0x4bc97de,0x43e9792,0xf454fd,0x455e7d0,0x4e3a904,0x1bb1eb0,0x48cd3d,0x6bead5e,0x71124c1,0x21e1d95,0x773d24e,0x2ed1663,0x6f9f032,0x515f6c8,0x6c67b09,0xb7f77e,0x74728d4,0x426e6ac,0x49a0529,0x35feaaf,0x69f9e7b,0x2869e17,0x5b0bfb5,0x4e7c4ef,0x487b0fe,0x6ee95d7,0x5768ac5,0x6c2e422,0x25bd1c6,0x7f6e275,0x9264a8,0x7eec1b9,0x14ff3b,0x20ea61e,0x3b6f38a,0x17cff30,0x6d28215,0x4af675b,0x3314fa9,0x2d66b59,0xc4e05a,0x3f83dc0,0x6fc0829,0x7d3a801,0x5f31349,0x5c3661b,0x33422b3,0x749d080,0x611ed27,0x4eb127e,0x7059df8,0x1fba41c,0x16a0e2d,0x4d8c23a,0x1c9a55d,0xb8e367,0x4a62a4b,0xf6f13c,0x221bf12,0x8008c8d,0x75e2d09,0x455af8a,0x4d86259,0x4a795b9,0x2829807,0x17db465,0x78cbc07,0x13e818b,0x36269fd,0x4aff55e,0x19a2b7f,0x3d8898a,0x22c8139,0x211b3e6,0x7a4a777,0x7cfa48,0x6c8e467,0x273d68,0x3736667,0x6bb2126,0x306f3ad,0x4bbcfd7,0x42980a6,0x536d6dc,0x1ecd05b,0x24750d6,0x7abe57d,0x7826152,0x280c017,0x29f696,0x972107,0x636de5f,0x4c6270c,0x20ec336,0x7cd3890,0x4f6695b,0x7d812cd,0x7d24295,0x56df8e8,0x32c234c,0x28e09ad,0x614a222,0x62cf3f4,0x320cc34,0x39f9351,0x6045d37,0x18aa271,0x60c4141,0x47379bc,0xb35036,0x5eb8ba7,0x7833692,0x3c19795,0x7558f4,0x4308d8e,0x74a896e,0x444ffec,0x60a9940,0x4f36b02,0x7a6fd03,0x72ed39f,0x5c394a4,0x6428ddc,0x4051209,0x77a7c23,0x25f8654,0x4d3200e,0x30a39d4,0x64905a1,0x3277ccb,0x1c8243,0x74d1181,0x2fa171e,0x294cbd4,0x50daf3c,0x51864c6,0x2db4e5,0x6b2f3a3,0x2ad69d9,0x9ab907,0x4990b7b,0x18e9ae6,0x5b0ebd3,0x7cf100e,0x288d15b,0x2d3038e,0x6e4bfe3,0x8a4d05,0x5765da3,0x411a39d,0x691532,0x32bdc9f,0x6529766,0x7a2da34,0x4441416,0x1b746be,0x298a23,0x60e37c3,0x7169326,0x5a74aab,0x109e47e,0x3e0d746,0x3ae10ca,0x1976153,0x6b1d570,0x44d0848,0x3d2c343,0x3264897,0x64f99df,0x297910d,0x7447561,0x3caafe6,0x71d154c,0x4a9d4e7,0x42baf5a,0x16658f,0x124dfa2,0x1bd6350,0x75e9084,0x795453,0x39e28d4,0x2f22307,0x5321fdc,0x2e85bdf,0x56fed28,0x6bee8d5];
const IROOTS: [u32; 1024] = [0x7c1ffe1,0x1cbd8f9,0x7a1df83,0x3adfe19,0x431d067,0x76492cb,0x7decffb,0x58fcaa4,0x3970837,0xe306c2,0x29e15f3,0x2933c18,0x37a3999,0x7e6d5d2,0x1a015c3,0x902919,0x1020f5e,0x57dfc2d,0x61e60eb,0x2bf7e38,0x18746a9,0x2dfdb5e,0x754b12a,0xc1aa16,0x4c4fc90,0x112ba75,0x84898a,0x27a0a79,0x173244c,0x4c37729,0x5e8195a,0x3d01886,0x4997e23,0x5266893,0x2e357e,0x615880,0x64ea00a,0x4cca38c,0x4439317,0x3d1252,0x7a63692,0x9a1e6f,0x74c3ce5,0x1a05500,0x21b2fe6,0xfd79af,0xf92690,0x1aaa99b,0x5f38b65,0x2726413,0x3ecb947,0x7aadc4e,0x6f03adb,0x17d2a79,0x41f9010,0x67a7f79,0x42788ef,0x3fbcc7b,0x5d760b2,0x6245a4b,0xece9a7,0xa8b9ee,0x300c624,0x3eac541,0x7c98e9e,0x143d221,0x3f4107c,0x6ed8dde,0x368e5f4,0x4b03de3,0x74e090c,0x7f944c,0x64cfc0f,0x2d1dc41,0x2805254,0x1b9139f,0x777afd9,0x2201d68,0x65404e2,0x52157b1,0x7d53f77,0x7492f3b,0x4311caf,0x71ed08c,0x8de4a4,0x39254e2,0x7757ff5,0x797debb,0x9d643c,0x7fef0bc,0x52c8671,0x6d6c54b,0x42e3a0,0x7e47d76,0x64076e9,0x6f0a9cb,0x314bb76,0x3136ce3,0x5fe2f6d,0x35a5c1,0x4dbd572,0x5fdd0ce,0x36a5236,0x67b5338,0x3d25168,0x7dd8b13,0x8139d1,0x2045439,0x5196fa7,0x6fed9e0,0x2b471de,0x43fc9c4,0x6cde761,0x2ff2e56,0x738804b,0x16c257,0x1aa1e9d,0xd026b6,0x7f0714f,0x5a42908,0x5a1c972,0x12aaced,0x6ea587e,0xc15624,0x1f14097,0x16aa511,0x3868c35,0x206144e,0x3b97384,0x3098b56,0x6fa9363,0x53dd617,0x7e56e7c,0x59ba960,0x7e86257,0x83267,0x3e99622,0x75b4e06,0x2172f17,0x2e6401e,0x7013cc7,0x5849aa6,0x20566d7,0x76b4f63,0x334e402,0x77371d3,0x6fb0e2c,0x1614fe3,0x1db6bc7,0x6148404,0x2d1a143,0x2dfbbac,0x57e66f8,0x79364fb,0x20e2143,0x46ffccf,0x4fcdcff,0x7fe6999,0x4a4cf19,0x597debe,0x29195e,0xc001d2,0x11126b0,0x7179699,0x78e92c0,0x5bd08a6,0xe98670,0x75ae5e,0x7a51118,0x13375ca,0x3d421f3,0x2f7f443,0x173bae6,0x1d1487c,0x1511eaa,0x5149fb5,0x5e7644b,0x3b16db5,0x534dbd4,0x1a4fb75,0x1fc822a,0x4446106,0x2c79d7f,0x330361a,0x14ea101,0x311b92e,0x16195bc,0x20e13ca,0x1471739,0x41e5fb,0x56a23f0,0x1420c43,0x28bb843,0xeb7e4f,0x6f891c3,0xdc4f06,0x795db6e,0x16ccde4,0xfea528,0xb2726a,0x11d5b31,0x11c42f,0x3b068e5,0x726c60f,0x1a64139,0x6340e1d,0x149adc1,0x42c6bb1,0x1478573,0x52e7062,0x57f5516,0x3f888cf,0x3a0db6d,0x22f1b58,0x5f18c91,0x6689baf,0x4ee2fc5,0x6e2d3da,0x137b576,0x62930cb,0x77fe670,0x338160b,0x209bd72,0xcc3fab,0x2b03d42,0x7a65202,0x531bd23,0x1a4af5a,0x7a38a4d,0x606fabd,0x3e4f8fb,0x4dbcc1d,0x730a647,0x49fa9a1,0x7daf97e,0x56d0bd0,0x2edcfcc,0x64257d6,0x2552a12,0x5c8e8a3,0x4610233,0x1149766,0x306a89d,0x5c84415,0x160c82,0x13ee864,0x66b255e,0xe85970,0x770efb4,0x2f8b042,0x7ae0443,0x62222d0,0x2a16143,0x40720dd,0x5165aa3,0x346dd1b,0x7235846,0x40440a8,0x1b8af7,0x4de1c15,0x43eddcd,0x5b88e8f,0x2cd11b8,0x19a616c,0xd54dc4,0x7818e97,0x77bb4a6,0x57b2610,0x2e5cacf,0x1cce6ed,0x602e7a5,0x2ba5bcb,0x4dd5a,0x64b5147,0x6db7630,0x55eb1eb,0x293d7b6,0x76dd81b,0x165f93e,0x5137908,0x5365bc4,0x767aef4,0x585b9dc,0x1ef697c,0x2b4b342,0x1358807,0x2789dfa,0xa8648d,0x331cce6,0x73d4792,0x68029a5,0x1dedc30,0x31a76e5,0xe46bd7,0x3927383,0x7b8b7a2,0x785d456,0x3748c23,0x74f0af2,0x27bbdc0,0x58be65a,0x6cddf2c,0x7c65176,0x6b26980,0x3b2ae51,0x15ab249,0x5f318a6,0x5645db3,0x2995da9,0x47a2abd,0x582105d,0x7f2b381,0x56e115,0x3ffde75,0x77286d7,0x3a2f95c,0x5a32f88,0x69ae44c,0x5aa6004,0x1f1b0eb,0x4cf100,0x4081891,0x741a80a,0x6b5bb94,0x1536f7b,0x7a07710,0xb00e98,0x20e8be4,0x77a73e1,0x449b143,0x17ab9b2,0x5ecabfe,0x745b3fe,0x4d67f23,0x7df6fb6,0x13f96d3,0x3de48e1,0x2141826,0xb9faed,0x58ea0cb,0x6f4a970,0xf5be63,0x609b13b,0x4e43d38,0x59eb972,0x26ecce2,0x1cd03a0,0x69423b9,0x7646bb6,0x6783f09,0x36df37c,0xea6e72,0x7a23209,0x491fcfc,0x6d3a56d,0xadc4a1,0x26572b5,0x32603d8,0x2eee42,0x3ac439d,0x1bcff8d,0x6f51726,0x288563a,0x6a1fd18,0x1de1d1f,0x5f5bb34,0x1001e47,0x694ad87,0x4111cd4,0x302ad78,0x696d442,0x4df1967,0x5b01faa,0x309f578,0x5278e03,0x543db56,0xfa95f4,0x6b2c022,0x56c1f22,0x1781132,0x440668,0x92cee4,0x1d79d7f,0x67ad9df,0x4215f8e,0x795b067,0x2cddce3,0x5161a69,0x36a52b8,0x6965885,0x83367e,0x13df85d,0x5fb868,0x5bb4954,0x236b7bc,0x660b617,0x25daad4,0x8cd1cd,0x314dbf,0x4b5df71,0x1570b44,0x6c59ded,0x767d92d,0x2e2d909,0x7b3c3ba,0x6c24008,0xea237c,0xb387e5,0x4264b45,0x3be6e40,0x302ae8,0x3b3973e,0x438769e,0x320e576,0x1d19005,0x597f6b5,0x74fbe93,0x4667d17,0x6faf18b,0x37fbcae,0x7223abd,0x5d5c57e,0x4769494,0x4f804f7,0x46645f2,0x433f017,0x79d25ba,0x78cc777,0x38eccfc,0x3438319,0x3824dd1,0x3c2c43b,0x49b5ece,0x37b4ad2,0x2552e07,0x13f8a10,0x53af869,0x1ca2b8f,0x7108886,0x65f6618,0x406d8ca,0x30dbb2,0x6db3348,0x79a26ca,0x78e329,0x2f190ce,0x1d78fdf,0x63c2c24,0x53af292,0x4946e9a,0x6027716,0x447a754,0x5752607,0x76bee98,0x6c0d068,0x2004ab1,0x45ed41c,0x170b461,0x4005b51,0x5881e9e,0x3c8b1a8,0x66c50a4,0x183d901,0x67ad700,0x247992d,0x66d7a9b,0x25772ec,0x93c967,0xf47917,0x3622c1,0x76d12e4,0x40bf847,0x2fde9d4,0x6cf5764,0x7c8ef22,0x21e458f,0x3b46bcc,0x1bc2d1c,0x37f3040,0x51a2d39,0x61b46d8,0xbff408,0x5f47142,0x140e102,0x5ba7d24,0x2e627d,0xfa0911,0x3788d52,0x5c1ff05,0x7535763,0x5f1d44a,0x1aa9622,0x4e7d515,0x77201df,0x4deec57,0x7b2c796,0x4d5860c,0x18160f8,0x112c033,0x2957a75,0x5c9fe83,0xf890e4,0x389f378,0x40cc434,0x81954f,0x79aefbf,0x53386da,0x19c3b9b,0x4031d76,0x230756c,0x2498af2,0x2a59155,0x143172c,0x29212d9,0x519a422,0x2cfe025,0x50fdcfa,0x463d72d,0x788abae,0xa36f7d,0x6449cb1,0x6dd205f,0x7eb9a72,0x3d650a7,0x3582b1a,0xe4eab5,0x437501b,0xbd8aa0,0x56a6ef4,0x1b26622,0x4dbb76a,0x42f3cbe,0x3b4f7b9,0x1502a91,0x66a9eae,0x453ef37,0x42128bb,0x6f81b83,0x25ab556,0xeb6cdb,0x1f3c83e,0x7d875de,0x64ab943,0x3bdebeb,0x5f25cd,0x1af689b,0x4d62362,0x798eacf,0x3f05c64,0x28ba25e,0x777b2fc,0x11d401e,0x52efc73,0x5792ea6,0x32eff3,0x251142e,0x673651b,0x368f486,0x76746fa,0x5549628,0x14f0c5e,0x7d44b1c,0x2e99b3b,0x2f450c5,0x56d342d,0x507e8e3,0xb4ee80,0x7e57dbe,0x4da8336,0x1b8fa60,0x4f7c62d,0x32edff3,0x5a279ad,0x8783de,0x3fcedf8,0x1bf7225,0x23e6b5d,0xd32c62,0x5b02fe,0x30e94ff,0x1f766c1,0x3bd0015,0xb77693,0x3d17273,0x78ca70d,0x440686c,0x7ec96f,0x216745a,0x74eafcb,0x38e8645,0x1f5bec0,0x6775d90,0x1fda2ca,0x4626cb0,0x4e133cd,0x1d50c0d,0x1ed5ddf,0x573f654,0x4d5dcb5,0x2940719,0x2fbd6c,0x29ed34,0x30b96a6,0x34c771,0x5f33ccb,0x33bd8f5,0x1cb21a2,0x76adefa,0x7d8096b,0x5813fea,0x7f9eaf,0x561a84,0x5baaf2b,0x6152fa6,0x2cb2925,0x3d87f5b,0x346302a,0x4fb0c54,0x146dedb,0x48e999a,0x7dac299,0x1391b9a,0x78505b9,0x5d588a,0x5f04c1b,0x5d57ec8,0x4297677,0x667d482,0x3520aa3,0x49f9604,0x6c37e76,0x7543fa,0x6844b9c,0x57f67fa,0x35a6a48,0x3299da8,0x3ac5077,0xa3d2f8,0x8037375,0x5e040ef,0x70b0ec5,0x35bd5b6,0x7491c9a,0x6385aa4,0x3293dc7,0x697f1d4,0x6065be5,0xfc6209,0x316ed83,0x1f012da,0xb82f81,0x4cddd4e,0x23e99e6,0x20eecb8,0x2e5800,0x105f7d8,0x409c241,0x73d1fa7,0x52b94a8,0x4d0b058,0x35298a6,0x12f7dec,0x68500d1,0x44b0c77,0x5f359e3,0x7ed00c6,0x133e48,0x76f9b59,0xb1d8c,0x5a62e3b,0x13f1bdf,0x28b753c,0x1136a2a,0x37a4f03,0x31a3b12,0x251404c,0x57b61ea,0x1626186,0x4a21552,0x367fad8,0x3db1955,0xbad72d,0x74a0883,0x13b84f8,0x2ec0939,0x1080fcf,0x514e99e,0x8e2db3,0x5e3e26c,0xf0db40,0x14352a3,0x7b932c4,0x646e151,0x31e56fd,0x3ac1831,0x70dab04,0x3c3686f,0x3456823,0x69cf7a3,0x21e1a4c,0x58df6a8,0x12d6dbe,0x561e5ee,0x6137185,0x3aaedb,0x4778812,0x6abe009,0x6c6fe22,0x697a118,0x396ba72,0x43fb8e5,0x4f01333,0x520ef19,0x2fa3d3e,0x2057b2c,0x668cb01,0x4350ec0,0x321ea52,0x5b78391,0x4f02b8d,0x5241b83,0x1167d05,0x5ba8fe7,0x1cd3bfe,0x7b32365,0xd84a1e,0x566d64f,0x54c8380,0x16e038e,0x7215e90,0x55146af,0x7163e9,0x68718b5,0x236de68,0xd8095d,0x75c75bc,0xa8822e,0x49c79c4,0x37a0dab,0x70669ca,0x6096618,0xdd44c,0x374b33b,0x11880ca,0x1258a6b,0x3a2eff6,0x6c5def4,0x67285db,0x44e4c5b,0x520e35,0x2840b00,0x69071dd,0x671a1be,0x4844c0c,0x180e029,0x1591bde,0x50f60b2,0x2363819,0xe7d2b4,0x7f4de34,0x310b2d7,0x7ac57ed,0x26beba6,0x268e065,0x7755802,0xb4dd3b,0x2aa2aa8,0xa5a79f,0x32fb007,0x6208690,0x79a603e,0xa67f06,0x5d77b8e,0x72a9dfc,0x7275ce5,0x2a7437f,0x348a43,0x785cf2c,0x6d4244f,0x776967f,0x40ec715,0x6179ac8,0x4ba8d8e,0x106b202,0x24de06a,0x76e67f8,0x1edebb6,0x4d01b75,0x1b4c9a2,0x3a9a38e,0x18b7ada,0x5bb50bc,0x5a3e7fd,0x1457782,0x3aacb46,0xdf062c,0x2de22d3,0x7fcbce4,0x32892ac,0x556e21b,0x3bc26e0,0x45251a8,0x557a7f9,0x1417acd,0x7ca4bb6,0x4b7ceda,0x6dfcb84,0x2fad1ea,0x3ca3cb7,0x5afc505,0x6ad24f9,0x6302651,0x79605e2,0x70bbc3c,0x4350da8,0x7d5415e,0x1cf4b6c,0x39daab6,0x4bda64c,0x2af96a9,0x45511ab,0x6e4b346,0x77f3fdf,0x4e129e3,0x1554e34,0x22257e,0x751ebeb,0x6e75e3b,0x16e2bfa,0x45237b3,0x66c186c,0x732fba4,0x672f9fb,0x3b05f2d,0x134f522,0x369bbb7,0x157e02b,0x6db9d04,0x7da02ae,0x3287596,0x131b920,0xb4d149,0x7f2725d,0x5d69283,0x13ef4ec,0x4dbf845,0x7dfd032,0x54985f7,0x22b0d4b,0x6001204,0x248f138,0x1dd01d9,0x350e7ad,0x7393ec5,0x109e12e,0x42e21b9,0x63bebac,0x74d980c,0x59028fa,0x31d1c6e,0x652d772,0x1bbd9fa,0x6711eec,0x50b8058,0x174e9cd,0x535df56,0x35f1142,0x9e6893,0x49d049d,0x2a35865,0x5311013,0x7500744,0x2c3dd24,0x4f14e8d,0x2b07d28,0x2540c82,0x180bc98,0x733013b,0x342bebf,0xd7f26a,0x72dcbab,0x48b517b,0xabd673,0x77e969e,0x376abab,0x686163b,0x6edbd55,0x2e4d911,0x150ba5,0x23f7121,0x51b617c,0x74b08e3,0x533bed3,0x2184eb3,0x1745bcb,0x46618f2,0x2c083b0,0x3a173b7,0x15f05e8,0x1223a73,0x7f16440,0x70aff38,0x7f1bbe4,0x688824a,0x5f60d86,0x3c912d9,0x2978480,0x698ed82,0x7ac7306,0x2ff8d6f,0xea2476,0x35e4352,0x29f2fcb,0x49bfd09,0x3fc66,0x7176817,0x3ffb40,0x64c0f1,0x1f1d11,0x36b092,0x37d03c,0x45ab93f,0x7894cd8,0x64b48ac,0x7ac082a,0x297df4a,0x36ec4dc,0x28c330e,0x1736d0b,0x7bfbf40,0x50ea05e,0x1e7d2b9,0x4f4faea,0x326f2d6,0x2497c2c,0x2886566,0xada14e,0x7d25e0a,0xf0b41f,0x7b89ace,0x16285f1,0x7334397,0x182dc06,0x39b8454,0x3ec3363,0x10727b0,0x4a27cf7,0x1b9e7ec,0x1fe72a,0x6ec89b6,0x2789a3d,0x775181e,0x5e5e191,0x51d3e94,0x7f7a02e,0x24ee2d8,0x2328f1c,0x10eeea0,0x78ebfae,0x7cef936,0xf73f7b,0x630cb4d,0x5164d77,0x6935f6e,0x4201808,0x295db80,0x72fa5eb,0x1f91626,0x46e2627,0x6ce8e5b,0x318d9cb,0x2de3537,0x3683a30,0xe50dac,0x1f9cc3e,0x3edb718,0x438ead5,0x3f0267e,0x13b4aea,0x7021b78,0x3ca0f7e,0x20402a1,0x738bf6,0x5a231fb,0x4faf23c,0x39f359e,0x7a9e186,0x315aa85,0x2ddb436,0x75b3c3d,0x175358f,0x7091992,0x24597a4,0x66f672,0x54aa13e,0x420fdbf,0x2dd3230,0x5d52625,0x3cf0617,0x2a784c9,0x211045b,0x7a2b566,0x36bd071,0x372cf7a,0x304cc56,0x3ae8bba,0x38bbb63,0x4e01651,0x4c13764,0x5566396,0x7e8df37,0x4ebb82c,0x722609a,0x7badc8a,0x86aae0,0x72a7236,0x3f0d0d,0x526dd3e,0x4e71233,0x797fbec,0x389ebf8,0x31b6239,0x5821578,0x347d322];

// TA public key in NTT format
const H: [u32;1024] = [0x377e3ac,0x2360cb0,0x5841181,0x3ef642b,0x4fb0d0,0x17c0de,0x76a2ab5,0x651d1a0,0x25498d,0x41f52e5,0x5c534e2,0x6f5e332,0x6b3c6b6,0x23afb52,0x36b5eb8,0x1714f92,0x5b1e345,0x308f251,0x45277e9,0x7fea756,0x197f90f,0x7f10e43,0xf136e5,0x53a546d,0x42e5ed3,0x3a83ce9,0x1be404f,0x4b423,0x7458a12,0x3990ae0,0x59ea53f,0x7120158,0x53c1e4c,0x2c26ded,0x55b3324,0x6c16736,0x40ed524,0x36e3f9e,0x548fd7d,0x25feb0,0x18b32c0,0x7b98356,0x1d9e22,0x1e791c3,0x4b4f653,0x2b9b5c0,0x13ac4cd,0x1fc4bd7,0x7196c5b,0x6cb7ab2,0x4a04d36,0x57486db,0x7972f4b,0x2a64ed2,0x30d6f31,0x64f0443,0x33352ca,0x4bef8bd,0x315c46a,0x4eb8b62,0x5de0c0b,0x22fdc7a,0x3ae7eae,0x78a3cfa,0x169ec52,0x64e725d,0x15dc340,0x3367ed3,0x1ee1ba7,0x39522fe,0x70a1973,0x655158c,0x5c91545,0x662d3c3,0x622e99e,0x6b42bcf,0x5ca7c85,0x42e93ac,0x325a086,0x408cc43,0x5801e57,0x4e412e9,0x2459d87,0x71a4ca4,0x3f1b0b0,0x7336021,0x48fef71,0x59c8427,0x63a89eb,0x731c8d6,0x460ccfa,0x6b9e8c0,0x36e542e,0x50a2334,0x1762a7f,0x5be94be,0x4ea626a,0x3ec7299,0x614a747,0x2d11f30,0x800f076,0x73486bc,0x26679e8,0x6880939,0x2541798,0x77ff34b,0x310136e,0x7a360f2,0x1b52ac0,0xfb887,0x65d6b54,0x469807d,0x252cb62,0xbff315,0x6fe7a1f,0x4244d2a,0x65d706f,0xc8ab7a,0x128a9c8,0x61e4e65,0xfde5a,0x392acb,0x1613400,0x5906fad,0x6e93932,0x75f599b,0x19424fe,0x5d2d30a,0x4337643,0x6800ec4,0x3eb06f9,0x3497960,0x7798f3e,0x39e1aa7,0x2193267,0x120d716,0x6754886,0x4c762c5,0x5934a21,0x3006633,0x489996f,0xbcddc3,0x325ed6b,0x1872a98,0x5025218,0x3aa692,0xd047cb,0x3abca42,0x286f6fd,0x68d9bee,0x7c3acbf,0x7576a73,0x52a1688,0x64000d,0x146fb7f,0x1b79c87,0x5b58168,0x55c2fd2,0x471a5ad,0x3369dda,0x3070579,0x70e70b7,0xa6b827,0x7dbe0ea,0x61f5222,0x3360d98,0x152c618,0x26a4008,0x41a8735,0x42645a7,0x7f20e6,0x166ce00,0x62298a2,0x2c845c3,0x2be2d6b,0x39baeff,0x631079a,0x6cf03c,0x69ebdb6,0x42baa1,0x32f120,0x2c18dbc,0x5214310,0x3f39556,0x518a26,0x58ee623,0x732d2a5,0x29ac71c,0x6716d00,0x1978ad1,0x1ea0cd9,0x273e4cf,0x4a7a364,0x97183e,0x30bf41c,0x6f84fdf,0xc9094b,0x5da21cf,0x65fb540,0x637a07b,0x9b89bb,0x2efb071,0x73366e2,0x77eccb4,0x3e37d2c,0x13600b5,0x24394a,0x4bb6252,0x5983c53,0x2bb7dd8,0x6307988,0x7165bd8,0x2bbdf23,0x3b1c2e8,0x5f9b60f,0xf31cc7,0x36ab176,0x55ae611,0x51b2830,0x4f6bc12,0xc3cd6c,0x7f01bfe,0x6eacd2,0x1783dfc,0x24917b6,0x4922140,0x25473d7,0x20b5b13,0x13fecc5,0x7a088cb,0x2e25cd7,0x58998c2,0x24e190c,0x443fe75,0x7a8dd11,0x5042d9,0xc65a71,0x4b5afa2,0x409924a,0x3cc3531,0x31a3358,0x72c9b5a,0x74e6a37,0x6aa6040,0x394f548,0x67d4c0d,0x21bb02a,0x74dfbea,0x455d831,0x58fe8f0,0x46b0c09,0x6edba4d,0x74c5063,0x37bf9a6,0x114d925,0x113c16c,0x35ab796,0x6fdd797,0xf80d49,0x3a613cf,0x6e34724,0x442c9ef,0x1301a7,0x7b9c20,0x46a65ce,0x709832b,0x526cf49,0x26f8134,0x5706dba,0x33605aa,0x246556d,0x2c173b1,0x16798c2,0x2f9e079,0x3936798,0x2b4b931,0x3012784,0x72fce5d,0x4708819,0x6e8f495,0x7690898,0x25d2691,0x12d163,0x5f46d2b,0x60d576d,0x5f51064,0x3a18110,0x5217918,0x974971,0x1758994,0x7c4b13d,0x5110b91,0x16c1dce,0x6223ae4,0x3c07fc3,0x2f83045,0x2ce96bd,0x1d50d92,0x61136dd,0x3b677b,0x321c168,0x2d3f3a5,0x12576be,0x365e366,0x33bb933,0x46e9b62,0x5ad0bea,0xe9ac84,0x6b944fd,0x1d302ab,0x602164b,0x5b42a5a,0x15e06b3,0x36e77e1,0x30f7efd,0x4e95aca,0x6d25558,0x4e81718,0x526febc,0x6a23e0c,0x4244242,0x2faf835,0x28a3a7f,0x1020b5e,0x56df169,0x2d714b7,0x1d2ec6c,0x1874d4,0x2b63c87,0x1356ac6,0x2c184d5,0x7240dfd,0x67d8856,0x4be1526,0x299f701,0x2e97da4,0x129357f,0x177d3a5,0xe5e47,0x76ae2c5,0x204cd26,0x3901b87,0x20c1960,0x296f293,0x137e972,0x5190f21,0x4c7bcc3,0x18cfa22,0xca6539,0x7d32bfb,0x6f0f842,0x7f495a8,0x15dae55,0x4648139,0x5682ad0,0x7c5c67c,0x3738cef,0x24d3245,0x1d9a985,0x40dcb42,0x24de229,0x5cc81f5,0x4d57b74,0x4d207a7,0x6c2860c,0x2a87b4e,0x5a44938,0x2e91fa8,0x42d9f49,0x3d95d1f,0x3a99a23,0x2f9a7c7,0x66a97e1,0x1d1d9fb,0x623b30e,0x1f1a5dc,0x852204,0x39843a8,0x6262e02,0x6aa8c16,0x75eaef7,0x71efd55,0x62ab01b,0x7721d13,0x76d859a,0x101f3f6,0x59fb8c1,0x207f290,0x31519b8,0x60f3b54,0x2884d1c,0x2de31a4,0x173afb9,0x4ed680,0x5e2f62f,0x7490c69,0x54ef3d6,0x607c8a3,0x5bb2e42,0x1af69b5,0x23c83a6,0x56447c9,0x7852be8,0x4a3613c,0x110b98e,0x235ae7e,0x31bdb3e,0xec48fd,0x33e0dfa,0x7c778c9,0x64aecdc,0x51b34dd,0x2e5175f,0x7011933,0x49ee13f,0x65cb8f,0x36cbd56,0x5064da7,0x1a80a67,0x1969517,0x6a38c63,0x7c28d6a,0x34bb2a,0x7a876f3,0x342f5e0,0x2fbb12f,0xb25fac,0x3ca6e83,0x15b9cba,0x103b4ff,0x408771e,0x31ee966,0xd7c7de,0x2d0bf76,0x9ab853,0x3a3f9af,0x606595e,0x69d221f,0x6dd45bd,0x33d0c1c,0x23888fb,0x22361ce,0x2e2fadb,0x1a1cc3f,0x7132901,0x2c817fa,0x4157f7c,0x55db333,0x2f0de77,0x38e10fd,0x214f489,0x174c758,0x3da51a5,0x572254a,0x1868348,0x77cc0b9,0x3ce6a12,0x1036ad3,0xd3d696,0x6b11906,0x22735d1,0x7425489,0x7a28d4b,0x4a8a808,0x1a22793,0x6529113,0x139b11f,0x4550de9,0x36be09,0x606ad5d,0x77c98df,0x156058a,0x4d506ca,0x12525aa,0x275e9d5,0x7b92544,0x672b0ff,0x931867,0x678a235,0x185cca6,0x51c77e3,0xb16f85,0x30e02e,0xcc5355,0x58115f,0x148f6e1,0x4262907,0x24b2b45,0x1893364,0x6de5df1,0x74b5ae3,0x7704a8c,0x1dc25a6,0x2bf9703,0x18ceba4,0x78ab580,0x3379bd1,0x588f134,0x15914ca,0x799f482,0x6ab968,0x515cea,0x71d79d1,0x721afda,0x2a39159,0x5e544c0,0x10dd915,0x19b99ec,0x63bb11a,0x15cd90,0x7c9c9e5,0x6b681f5,0x210488d,0x85108e,0x6d92960,0x4c90aa4,0xca81d4,0x75c0bc0,0x77791c,0x17a067b,0x78e440b,0x53a93ee,0x5405009,0x56c1820,0x6a15962,0x39f96cb,0x25d0ff7,0x5949b66,0x78c6d1b,0x6074dfd,0xd9d39e,0x708feac,0x5640323,0x3b17eb0,0x2c8973,0x2c8c4c0,0x5a9a13e,0x6884db7,0x439b45b,0x2106e9a,0xac5c79,0x5dae202,0x1310f16,0x18d049b,0x7f1c7f0,0x5b89ae1,0x52eff13,0x30e3bbe,0x5168608,0x6e7a9f,0x1dc283,0x561d17c,0x7c80555,0x717ce18,0x2758c12,0x33648e0,0x62cff39,0x27d70f5,0x8cdc0e,0x5e8ea65,0x895e62,0x170a599,0x183b830,0x5d7a6ee,0x5fde98c,0x6586b06,0x46856c6,0x801797c,0x60250b7,0x71c319e,0x33c7b1b,0xee0a74,0x4de1f09,0x16dfbcc,0x1f8eb70,0x602aebf,0x66aa4e5,0x1f28478,0x5f3705d,0x1d491fb,0x72f44e6,0x50b1b3,0x18f943c,0x324f3cf,0x3ccc236,0x23b2093,0x8c349a,0xe742c2,0x3c6c5f7,0x2958d29,0x69ac3b7,0x1e5f60a,0x596c48b,0x6aa31f2,0x66e668b,0x45a6166,0x55799e3,0x22e5e06,0x51134fe,0x4c2f853,0x226a6ce,0x1afae06,0x22293a7,0x3f8554,0x6aa7aa4,0x13cd0ab,0x1a95d67,0x6f597ae,0x4d86a24,0x4d86186,0x6c63795,0x51733f0,0x7413b68,0x2bf1065,0x7cef545,0x3885e35,0x5e25e1d,0x476285d,0x7802a69,0x2a3b758,0x4aad59c,0x9f8cc7,0x13abee1,0x10bce32,0x51d1e6e,0x600b6ba,0x683d9ec,0x5da71d0,0x9fdd65,0x513da62,0x5b89037,0x1f04ac9,0x663909,0x49eb4b4,0x6de306e,0x2c608c7,0x637b5ab,0x2b4569f,0x14fc96f,0x3fb247,0x2d0f06f,0x4d395f5,0x6139db3,0x7060a13,0xd23800,0x757718e,0x7bac474,0x485dbcd,0x2f7fc75,0x5470a51,0x22d83b,0x2c0e18c,0x1a38f32,0x319c112,0x315855f,0x5c1f68f,0x5c7d3ef,0x426d659,0x4c546ec,0x5650a59,0x7fcc7dc,0x5e85103,0xa5ff03,0x768adaa,0x3d725b0,0x5f2c4c5,0x326fedc,0xf862cd,0x3f7d1e3,0x2419447,0x78a5cba,0x5156c17,0x5b3100b,0x5bd5db3,0x57734e5,0x306c5b0,0x431a133,0x6710fda,0x5fb4bde,0x18a7d45,0x20e993e,0x418ff53,0x7c7ac7,0x2f67806,0x3d7aef8,0x6fcd3c5,0x2e57f8d,0x61835b9,0x1b79247,0x1a764e5,0x393e5dc,0x3c5095d,0x4df1e3d,0x16ed9e2,0x23ce993,0x4b8c002,0x56f37c7,0xb78b4e,0x772a665,0x4e174a3,0xe9d697,0x341d634,0x671c049,0x30070dc,0x6b661e6,0x4d962a3,0x5b6c05d,0x418723a,0x3ecca9f,0x4e75db9,0x1b84a70,0x192af1a,0x6e64168,0x6b20c83,0x7c4a4b,0x47d18b5,0x5ceb492,0x38cca1f,0x36fb59b,0x5f6f4d7,0x218d94a,0x429c411,0x3e20f8b,0xa2f49f,0x15be4e2,0x69a75b4,0x335cbd1,0x622e90b,0x58021b7,0x45cd581,0x2ecff8e,0x30dbf67,0x2b63d19,0x4e5d7d1,0xaa1122,0x4243cdf,0x4dbb9c,0x390acf9,0xdf1f53,0x78c38c0,0x253ebec,0x34ad12d,0x40ed99e,0x413f7ed,0x293108b,0x7233723,0x7571447,0x3f98a72,0x68cad3a,0xab5195,0x10af3f4,0x5d5abbb,0x677b7d0,0xaa5970,0x507f4e9,0x1529cde,0x4bd461d,0x564541a,0xa92a3f,0x1221af,0x33e8927,0x36abcda,0x15f434d,0x4e091ad,0x3d0dcab,0x6056a3f,0x22cb1ad,0x349f4c7,0x4703e5f,0xb53ee1,0x36f3b03,0x5695df,0x2e07e6d,0x7a5e49c,0x1dca3ae,0x314d93,0x2d93c87,0x187d956,0x7f49488,0x62b143f,0xe30574,0x19f61b9,0x40e298b,0x77801bd,0x456108e,0x7f7ace4,0x200b80b,0x3d8e631,0x4218d7a,0x10312bc,0x54462b,0x2466b11,0x5c38b9,0x7ab99de,0x7b8c192,0x5b5b75b,0x757bd87,0x5be9f20,0x887b68,0x47a624c,0x23f2c2f,0x2693e64,0x7a0e484,0x3635e7f,0x259d8d2,0x7c7dd8a,0x59abde1,0x3b4b658,0x605ef55,0x298b136,0x57655ab,0x8c5e54,0x2c4ce91,0x5820d2e,0x16911c8,0x38c421a,0x604a251,0x51c06e5,0x3c70a52,0x56a4ffd,0x605d5dd,0x2259b23,0x6a1e0d3,0x6384c16,0x2523d50,0x7f7374e,0x1992354,0x25a854b,0x3d33eb5,0x502b7bc,0x1a8a059,0x455b4ec,0xa4e7e5,0x4258fd7,0x6468d44,0x1845bef,0x52f9f4c,0x6e4e591,0x3681eea,0x711278c,0x255f6fb,0x77e6067,0x2625a0c,0x976464,0x69bd825,0x348c924,0x1eaee70,0x245a55f,0x4bb4e7d,0x7fb363f,0x56689fc,0x3155ef0,0xfdedbc,0x6ba113f,0x69aa598,0x3aa95c6,0x20475ae,0x204b624,0xc1cd31,0x5552a6,0x2e28e54,0x32ed92d,0x4c42445,0x2780720,0x7ec4fb3,0x62a791d,0xfca712,0x4fa24a2,0x4c1acb2,0x3a9b11a,0x3aaf977,0x2161312,0xb45b8b,0x5087b66,0x2ad83f4,0x2dc9633,0x3b1da6e,0x57e5881,0x2741763,0x63cd22,0x215e9b4,0x5614da5,0x217134b,0x66d5cc8,0x4a48a8e,0x664a46d,0x7fb33ca,0x2b4a5ce,0x646d5da,0x26d8854,0x274bde1,0x28668a6,0x6ac9b6d,0x17b17af,0x2a9c5f0,0x11d9aac,0x4e0908f,0x4e5ba9f,0x45c6a32,0x67cbfde,0x4fddb5a,0x7c0ab08,0x1f5c2f8,0x320b5cb,0x3b1fc26,0x667aa46,0x129e8b2,0x1d098e9,0x29635a2,0x78ab019,0x6b62e6f,0x390cb0b,0x4858319,0x3129817,0x3ec0f33,0x1a79dc2,0x1b32f49,0x58cb4cd,0x30ccc0,0x5ef2398,0x5f282b0,0x4804dfc,0x3156aaf,0x5fef5b5,0x6cd995f,0x7c2d048,0x5d967cc,0x2bfd61c,0x7496c44,0x96d5f6,0x2f2ce2,0x6ef6f06,0x1704980,0x466a39,0x210aef4,0x7242fde,0x6bcf42d,0x2584d1b,0x708da42,0x195f6b,0x6a6b70f,0x43fea69,0x3043fc,0x3b5c396,0x29d78df,0x29f5748,0x31ca59a,0x46f93c,0x703582f,0x115bf,0x43fac3,0x5029494,0x64e518a,0x5267f1e,0x6f34a89,0x1b4c416,0x15e4630,0x2d7eae7,0x55cd171,0x5fab087,0x11cc383,0x1eb2fbc,0x43e682d,0x430c7d9,0x60fa28,0x413ad72,0x4b56a22,0x6fbc498,0x1f8858a,0x238a96b,0x4869439,0x6f334e7,0x7c9737b,0x7634fdd,0x1dcb9f7,0x5be249a,0x5716fec,0x16cc3fb,0x291eb70,0x2c06aac,0x493f3b,0x4aba690,0x433c2d8,0x50a029d,0x376baa9,0x792ac7a,0x86f7a1,0x21ffc32,0x634fcc5,0x2ac6037,0x669a60a,0x3f6ae71,0xe3a783,0x70b68d5,0x4e415ce,0x15bdfe9,0x5211065,0x419f9a8,0xae2fed,0x57f38eb,0x4548482,0x1ac2eb6,0x76b3309,0x52c34a4,0x444e63a,0x18bd3f5,0x356572f,0x6d6fa48,0x3c1e8d7,0x4bae0e9,0x63bbdbd,0x1866492,0x5bfd368,0x3b9739a,0x24c216,0xf50471,0xd94777,0x5e2a3c7,0x767072b,0x36a5764,0x78888ac,0x5c6b3d5,0x38200b9,0x658ed81];
const RKEY: [u8;128] = [103,198,105,115,81,255,74,236,41,205,186,171,242,251,227,70,124,194,84,248,27,232,231,141,118,90,46,99,51,159,201,154,102,50,13,183,49,88,163,90,37,93,5,23,88,233,94,212,171,178,205,198,155,180,84,17,14,130,116,65,33,61,220,135,112,233,62,161,65,225,252,103,62,1,126,151,234,220,107,150,143,56,92,42,236,176,59,251,50,175,60,84,236,24,219,92,2,26,254,67,251,250,170,58,251,41,209,230,5,60,124,148,117,216,190,97,137,249,92,187,168,153,15,149,177,235,241,179];

/* Montgomery stuff */
/// Montgomery REDC function
fn redc(w: u64) -> u32 {
    let dp=PRIME as u64;
    let m=(((w&0xffffffff) * ND)&0xffffffff) as u32;
    return (((m as u64)*dp+w)>>32) as u32;
}
/// conevrt to n-residue
fn nres(x: u32) -> u32 {
	return redc((x as u64)*R2MODP);
}
/// modular multiplication with no division
fn modmul(a: u32,b: u32) -> u32 {
	return redc((a as u64)*(b as u64));
}

/* NTT code */
/// Cooley-Tukey NTT 
fn ntt(b: &mut [u32]) {
    let q=PRIME;
    let mut t=DEGREE/2;
	for j in 0.. DEGREE {
		b[j]=nres(b[j]);
    }

	let mut m=1;
	while m<DEGREE {
		let mut k=0;
		for i in 0..m {
			let s=ROOTS[m+i];
			for j in k..k+t {
				let u= b[j]; 
				let v=modmul(b[j+t],s);
				b[j]=u+v;
				b[j+t]=u+(2*q-v);
			}
			k+=2*t;
		}
		t/=2;
		m*=2;
	}
}

/// Gentleman-Sande INTT 
fn intt(b: &mut[u32]) {
    let mut t=1;
	let mut m=DEGREE/2;
	let mut n=LGN;

	while m>=LIM {
		n-=1;
		let mut k=0;
		for i in 0..m {
			let s=IROOTS[m+i];
			for j in k..k+t {
				let u=b[j]; 
				let v=b[j+t]; 
				b[j]=u+v;	
				let w=u+DLQ-v; 
				b[j+t]=modmul(w,s); 
			}
			k+=2*t;
		}
		t*=2;
		m/=2;
	}

	while m>1 {
		let lim=LIM>>n;
		n-=1;
		let mut k=0;
		for i in 0..m {
			let s=IROOTS[m+i];
			for j in k..k+lim {
				let u=modmul(b[j],ONE);  
				let v=modmul(b[j+t],ONE); 
				b[j]=u+v;	
				let w=u+DLQ-v; 
				b[j+t]=modmul(w,s);
			}

			for j in k+lim..k+t {
				let u=b[j]; 
				let v=b[j+t]; 
				b[j]=u+v;	
				let w=u+DLQ-v; 
				b[j+t]=modmul(w,s);
			}
			k+=2*t;
		}
		t*=2;
		m/=2;
	}

	t=DEGREE/2;
	for j in 0..t {
        let u:u32;
        let v:u32;
		if j<LIM/2 { // need to knock back excesses. Never used if LIM=1.
			u=modmul(b[j],ONE);  
			v=modmul(b[j+t],ONE); 
		}
		else
		{
			u=b[j];
			v=b[j+t];
		}
		let w=u+DLQ-v; 
		b[j+t]=modmul(w,INVPR); 
		b[j]=modmul(u+v,INV);
	}

	for j in 0..DEGREE {
		b[j]=redc(b[j] as u64);  
        let sp=PRIME as i32;
        let e=(b[j] as i32) - sp;
        b[j]=(e+((e>>31)&sp)) as u32;
	}
}

/// reduce inputs that are already < 2q 
fn poly_soft_reduce(poly: &mut[u32]) {
	for i in 0..DEGREE {
        let sp=PRIME as i32;
        let e=(poly[i] as i32) - sp;
        poly[i]=(e+((e>>31)&sp)) as u32;
	}
}

/// fully reduces modulo q 
fn poly_hard_reduce(poly: &mut[u32]) {
	for i in 0..DEGREE {
        let sp=PRIME as i32;
        let mut e=modmul(poly[i],ONE) as i32;
        e=e-sp;
		poly[i]=(e+((e>>31)&sp)) as u32;
	}
}

/// polynomial multiplication in frequency domain
fn poly_mul(p1: &mut[u32],p2: &[u32],p3: &[u32]) {
	for i in 0..DEGREE {
		p1[i]=modmul(p2[i],p3[i]);
    }
	poly_hard_reduce(p1);
}

/// in-place polynomial multiplication in frequency domain
fn poly_smul(p1: &mut[u32],p3: &[u32]) {
	for i in 0..DEGREE {
		p1[i]=modmul(p1[i],p3[i]);
    }
	poly_hard_reduce(p1);
}

/// in-place polynomial addition
fn poly_incr(p1: &mut[u32],p3: &[u32]) {
	for i in 0..DEGREE {
		p1[i]+=p3[i];    //**
    }
}

/// in-place polynomial subtraction
fn poly_dec(p1: &mut[u32],p3: &[u32]) {
// p3 must be fully reduced
	for i in 0..DEGREE {
		p1[i]=p1[i]+PRIME-p3[i];  //**
    }
}

/// polynomial truncate, but round
fn poly_shorten(p: &mut[u32]) {
	for i in 0..DEGREE {
		p[i]/=1<<(UBITS-VBITS-1);
        if p[i]&1 == 1 {
            p[i]>>=1;
            p[i]+=1;
        } else {
            p[i]>>=1;
        }
    }
}

/// polynomial unshorten
fn poly_lengthen(p: &mut[u32]) {
	for i in 0..DEGREE {
		p[i]*=1<<(UBITS-VBITS);
    }
}

/// hash identity to polynomial
fn hid(identity: &[u8],id: &mut[u32]) { 
	let mut sh = SHA3::new(sha3::SHAKE128);
	let mut hash: [u8; 4*DEGREE] = [0; 4*DEGREE];
	for i in 0..identity.len() {
        sh.process(identity[i])
    }
	sh.shake(&mut hash,4*DEGREE);

    let mut m=0;
	for i in 0..DEGREE {
		let mut n=hash[m]; m+=1;
		let mut s=n as u32;
		for _ in 1..4 {s<<=8; n=hash[m]; m+=1; s+=n as u32;}
        let up=PRIME as u32;
		s%=up;
		id[i]=s as u32;
	}
}

/// get n-th bit from byte array
fn getbit(b: &[u8],n: usize) -> u32 {
	let wd=n/8;
	let bt=n%8;
	return ((b[wd]>>bt)&1) as u32;
}

/// centered binomial distribution
fn cbd(bts: &[u8],f: &mut[u32]) {
	for i in 0..DEGREE {
		let a=getbit(bts,2*i);
		let b=getbit(bts,2*i+1);
		f[i]=(PRIME+a-b)%PRIME; 
	}
}

/// hash internal key of length DEGREE/8 into external key of length 32 
fn hdk(ikey: &[u8],key: &mut[u8]) {
	let mut sh = SHA3::new(sha3::HASH256);
    for i in 0..DEGREE/8 {
        sh.process(ikey[i]);
    }
    sh.hash(key);
}

/// expand key into a polynomial
fn expand(ikey: &[u8],key: &mut[u32]) {
    let mut m=0; let mut k=0; let mut next=0 as u8;
	for i in 0..DEGREE { // expand into polynomial
        if m==0 {next=ikey[k]; k+=1;}
		key[i]=((next&1) as u32)*PRIME/2; 
        next>>=1; m+=1; m&=7;
	}
}

/// shrink polynomial into byte array
fn shrink(key: &[u32],ikey: &mut[u8]) {
	let mut next=0;
    let mut m=0; let mut k=0;
	for i in 0..DEGREE { // shrink into byte array
		next+=((key[i]/(PRIME/2))&1)<<m; m+=1;
		if m==8 {
			m=0;
			ikey[k]=next as u8; k+=1;
			next=0;
		} 
	}
}

// array t has ab active bits per word
/// extract bytes from array of words
// if mx!=0 then -mx<=t[i]<=+mx
fn nextbyte32(ab: usize,t: &[u32],ptr:&mut usize,bts: &mut usize) -> u8 {
    let mut left=ab-*bts;
    let mut w=t[*ptr];
    let mut r=w>>*bts;
    let mut i=0;
    while left<8 {
        i+=1;
        w=t[(*ptr)+i];
        r |= w<<left;
        left += ab;
    }
    *bts+=8;
    while *bts>=ab {
        *bts -= ab;
        *ptr+=1;
    }
    return r as u8;
}

/// extract word from array of bytes
fn nextword(ab: usize,t: &[u8],ptr:&mut usize,bts: &mut usize) -> u32 {
    let mut r=(t[*ptr]>>*bts) as u32;
    let mask=(1<<ab)-1;
    let mut w:u32;
    let mut i=0;
    let mut gotbits=8-*bts;
    while gotbits<ab {
        i+=1;
        w=t[(*ptr)+i] as u32;
        r |= w<<gotbits;
        gotbits += 8;
    }
    *bts += ab;
    while *bts>=8 {
        *bts -= 8;
        *ptr+=1;
    }
    w=r&mask;
    return w;
}

/*
/// pack ciphertext
fn pack_ct(ct: &mut[u8],u: &[u32],v: &[u32]) -> usize {
    let mut n=0;
    let mut ptr=0;
    let mut bts=0;
    for _ in 0..ULEN {
        ct[n]=nextbyte32(UBITS,u,&mut ptr,&mut bts); n+=1;
    }
	ptr=0; bts=0;
	for _ in 0..VLEN {
        ct[n]=nextbyte32(VBITS,v,&mut ptr,&mut bts); n+=1;
    }
    return n;
}
*/

/// pack ciphertext and check its the same
fn chk_pack_ct(ct: &[u8],u: &[u32],v: &[u32]) -> u8 {
    let mut n=0;
    let mut ptr=0;
    let mut bts=0;
	let mut diff=0 as u8;
    for _ in 0..ULEN {
        let m=nextbyte32(UBITS,u,&mut ptr,&mut bts);
		diff|=m^ct[n]; n+=1;
	}
	ptr=0; bts=0;
	for _ in 0..VLEN {
        let m=nextbyte32(VBITS,v,&mut ptr,&mut bts);
		diff|=m^ct[n]; n+=1;
	}
    return diff;
}

/// unpack ciphertext
fn unpack_ct(u: &mut[u32],v: &mut [u32],pk: &[u8]) {
    let mut ptr=0;
    let mut bts=0;
    for i in 0..DEGREE {
        u[i]=nextword(UBITS,pk,&mut ptr,&mut bts);
    }
	for i in 0..DEGREE {
        v[i]=nextword(VBITS,pk,&mut ptr,&mut bts);
    }
}

/// ID is identity, ikey is input session key, ud/vt is ciphertext
fn cpa_base_encrypt(identity: &[u8],ikey: &[u8],ud: &mut [u32],vd: &mut [u32]) {
	let mut rd: [u32; DEGREE] = [0; DEGREE];
	let mut e: [u32; DEGREE] = [0; DEGREE];
    let mut sigma: [u8; 32] = [0; 32];
    let mut buff: [u8; 256] = [0; 256];

	hdk(ikey,&mut sigma);  // Use ikey as seed
    let mut sh = SHA3::new(sha3::SHAKE256);
	for j in 0..32 {
		sh.process(sigma[j]);
    }
	sh.process(0);
	sh.shake(&mut buff,256);
	cbd(&buff,&mut rd);

	for i in 0..DEGREE {
		e[i]=H[i];   // already in ntt format
    }
	ntt(&mut rd);
	poly_mul(ud,&e,&rd);
	intt(ud);

	sh = SHA3::new(sha3::SHAKE256);
	for j in 0..32 {
		sh.process(sigma[j]);
    }
	sh.process(1);
	sh.shake(&mut buff,256);
	cbd(&buff,&mut e);

	poly_incr(ud,&e);
	poly_hard_reduce(ud);

    hid(identity,&mut e);
    ntt(&mut e);
	poly_mul(vd,&e,&rd);
	intt(vd);

	sh = SHA3::new(sha3::SHAKE256);
	for j in 0..32 {
		sh.process(sigma[j]);
    }
	sh.process(2);
	sh.shake(&mut buff,256);
	cbd(&buff,&mut e);

	poly_incr(vd,&e);
	poly_soft_reduce(vd);

    expand(ikey,&mut e);
	poly_incr(vd,&e);
	poly_hard_reduce(vd);
	poly_shorten(vd);
}

/*
/// ID is identity, ikey is input session key, ct is ciphertext
fn cpa_encrypt(identity: &[u8],ikey: &[u8],ct: &mut[u8]) {
	let mut ud: [u32; DEGREE] = [0; DEGREE];
	let mut vd: [u32; DEGREE] = [0; DEGREE];
	cpa_base_encrypt(identity,ikey,&mut ud,&mut vd);
	pack_ct(ct,&ud,&vd);
}
*/
/// ID is identity, ikey is output session key, ct is ciphertext
/// This time checking that (ud,vd) does in fact compress to ct
fn cpa_check_encrypt(identity: &[u8],ikey: &[u8],ct: &[u8]) -> u8 {
	let mut ud: [u32; DEGREE] = [0; DEGREE];
	let mut vd: [u32; DEGREE] = [0; DEGREE];
	cpa_base_encrypt(identity,ikey,&mut ud,&mut vd);
	let d=chk_pack_ct(ct,&ud,&vd);
    if d==0 {
        return 0;
    } else {
        return 0xff;
    }
}

/// use secret key csk to extract ikey from ciphertext ct
fn cpa_decrypt(csk: &[i16],ct: &[u8],ikey: &mut[u8]) {
	let mut sk: [u32; DEGREE] = [0; DEGREE];
	let mut u: [u32; DEGREE] = [0; DEGREE];
	let mut v: [u32; DEGREE] = [0; DEGREE];

	unpack_ct(&mut u,&mut v,ct);

	for i in 0..DEGREE {
        let mut n=csk[i] as i32;
        if n<0 {n+=PRIME as i32}
        sk[i]=n as u32;
    }

	poly_lengthen(&mut v);
	ntt(&mut sk);
	ntt(&mut u);
	poly_smul(&mut u,&sk);
	intt(&mut u);
	poly_dec(&mut v,&u);
	poly_hard_reduce(&mut v);

	for i in 0..DEGREE {
		if v[i]>(PRIME/4) && v[i]<((3*PRIME)/4)  {
            v[i]=PRIME/2;
		} else {
            v[i]=0;
        }
	}	

	shrink(&v,ikey);
}

/*
/// encapsulate 32-byte key inside ciphertext ct
pub fn cca_encrypt(id: &str,r32: &[u8],key: &mut[u8],ct: &mut[u8]) {
	let mut ikey: [u8;DEGREE/8]=[0;DEGREE/8];
    let mut ss: [u8;32]=[0;32];
    let identity=id.as_bytes();
    let mut sh = SHA3::new(sha3::SHAKE256);
	for i in 0..32 {
		sh.process(r32[i]);
    }
	sh.shake(&mut ikey,128);
	hdk(&ikey,&mut ss);
	cpa_encrypt(identity,&ikey,ct);
	for i in 0..32 {
		ct[i+ULEN+VLEN]=ss[i];
    }
    sh = SHA3::new(sha3::HASH256);
	for i in 0..ULEN+VLEN+32 {
		sh.process(ct[i]);
    }
	for i in 0..DEGREE/8 {
		sh.process(ikey[i]);
    }
	sh.hash(key);
}
*/
/// decapsulate 32-byte key inside ciphertext ct
pub fn cca_decrypt(id: &str,csk: &[i16],ct: &[u8],key: &mut[u8]) {
	let mut ikey: [u8;DEGREE/8]=[0;DEGREE/8];
	let identity=id.as_bytes();
	cpa_decrypt(csk,ct,&mut ikey);
	let mask=cpa_check_encrypt(identity,&ikey,ct); // make sure to generate the same ciphertext

    for i in 0..DEGREE/8 {
        ikey[i]^=(ikey[i]^RKEY[i])&mask;    // if not substitute some nonsense
    }

    let mut sh = SHA3::new(sha3::HASH256);
	for i in 0..ULEN+VLEN+32 {
		sh.process(ct[i]);
    }
	for i in 0..DEGREE/8 {
		sh.process(ikey[i]);
    }
	sh.hash(key);
}

//extern crate mcore;

//const ID: &str = "TLS Client";
//const CSK: [i16; 1024] = [-4828,13907,9178,-23513,741,-1946,11231,6340,11356,5710,2939,2269,-1666,14806,2656,9556,-70,-5342,-19303,7530,12807,209,9503,9541,8140,-7245,-2565,-13440,8270,-8321,-1869,1289,-13043,9816,14399,-11130,6136,2359,-4429,18265,9210,9157,-1174,29370,2508,4256,-5641,2742,-13338,3856,-11494,-4369,-2308,8552,5816,2978,-7208,1829,21145,-5498,-12008,14711,-9359,8432,3468,6520,-4030,12983,4891,9566,14520,1960,7791,891,11975,-211,-1652,-4158,10991,16963,14863,-3859,10277,-16539,-9255,8210,-1799,13865,-21225,14872,5825,-4593,11538,7171,19807,1497,6145,-25636,10580,3224,-17890,-10598,-12051,-11255,3074,6222,3854,-1282,7169,2476,-4367,-14242,6748,5783,-17078,-11398,1323,-10532,1014,-8530,18449,-6437,10423,15440,-8376,7704,-26947,-642,-6708,-15204,-9901,29542,-6014,-1777,6312,-7669,8328,-15509,3083,-13668,-9106,-5543,9475,-9859,-2934,1490,-469,-6522,2162,30791,16900,-11157,-11152,88,510,-12547,-2897,-21709,-11323,-4540,-2421,-1216,5619,9508,-1464,-1372,12289,340,-677,17637,-3733,-1784,13891,7472,1374,-23531,-4070,1712,-2379,7150,2051,930,1788,2981,1112,-14630,1403,15912,-20347,-24973,-10634,-7814,-4176,-16613,2895,9246,671,5567,-9378,-5547,-7092,-2152,-806,-10988,7615,5358,-7798,-12252,-7209,-17684,-13907,-11800,-6486,-18237,10388,-2185,-15691,-2570,9362,13357,13162,-28403,3154,-27321,-6322,13929,-3101,-12232,15363,9007,16384,12066,3573,8333,18023,4656,-20644,1505,-4622,960,-2209,-1218,-17541,-12682,16570,7201,8680,-8229,-5538,-2743,-5360,9182,5435,-851,3599,9000,-7708,3440,8623,12232,-9860,-8136,14296,-234,-6889,-2666,23116,-20041,22898,-9955,-8329,5240,-4076,-490,18637,13068,10576,7069,-3133,-15110,-12176,11954,-9134,2021,-909,-6395,3320,2904,-11674,1735,-824,573,3733,10314,-32623,11907,7477,-5035,3398,5093,11902,1830,889,-12442,-8598,-861,20671,4635,-8995,-11943,3991,-2456,9949,17403,-4137,-6257,6042,-13324,13533,12473,14933,6718,19243,-5907,-16396,-10155,3156,16948,-5081,447,1162,-13639,-8826,10319,822,6946,2256,18681,3777,-1083,-17915,3698,-5601,-4761,692,6198,10273,18441,-1545,18941,14780,-5498,2754,-19770,-13794,-7391,-7866,13858,-8082,-2986,-9159,-2506,17267,1301,-7614,-12221,7904,12570,-6555,-9431,-6778,-25506,3346,6550,-13623,9307,3074,791,6395,10685,-8904,2333,10187,7290,-27403,-6450,6441,-2242,-2875,-19227,3285,-15155,-15826,3316,13308,2472,-864,14356,8791,19640,-18939,21704,5945,-9800,-12163,-6723,7083,11291,-8057,-9460,5881,-14518,-1114,-596,-26741,4821,11774,5570,17015,6497,3412,3196,18468,-5939,-13711,8808,-19579,-4633,-10996,-16279,4626,-5938,-21483,10271,5992,8307,8261,5885,-266,-13472,-6217,11872,-2114,-3617,-6661,1914,-16930,-5709,-1464,-5508,-19946,-12968,-8731,14441,5913,-3912,-9403,-14784,722,12512,-5716,25800,21094,2196,-21763,8989,-7264,-5394,-9654,-350,21537,-881,20463,-2515,-12677,-1517,-11789,14446,1722,9122,13080,13336,-4175,-6832,-4610,-8149,-5920,22919,-6966,23933,-10196,18479,24591,-7874,-2622,-7282,-16307,-15079,503,7690,14284,8383,-3876,22747,11596,1551,14726,-3158,-5854,-11392,-12919,1211,19468,-22781,6694,3477,8553,-3826,527,-7204,-7613,23531,-8535,-13146,-10955,130,-3427,-5120,-498,-708,-9796,18201,-23089,-10472,-4926,11026,-1542,1555,-4284,-12426,-4998,14500,7563,10715,3894,15067,-4352,-14501,-324,6186,25863,9912,12612,-4765,5015,-7772,2489,-26967,22785,3116,-17830,-4246,9119,-9672,12847,-4311,5905,-8626,-1812,573,2965,-19512,-2277,-5346,8219,587,6968,-2617,-12320,-1511,-13315,13055,545,3567,-2748,-8857,725,-2019,8628,-11838,3707,3295,7771,-373,-501,-10828,-13245,-8589,21150,-16104,-8245,7779,22721,3562,572,-4011,14139,1340,11651,8058,2880,8242,-698,-11287,-6946,-4012,4564,-760,-4022,11658,17674,2021,-1109,23492,-13423,-13451,32023,3008,19448,29779,-7079,411,11909,4816,14655,12562,-9249,31211,8358,-13164,-6779,7865,1937,-4719,6179,-4530,-5632,-8772,10252,14339,11163,-12869,-2834,-13315,-3466,6992,-7554,-6827,272,-10657,14907,-22195,18669,-6763,-13479,-9933,-9186,15159,21992,-20170,-2995,4800,-940,14866,13981,-13086,-1366,15315,-7089,-11636,711,-13986,1238,1784,-7085,11735,7420,-12678,-9208,-11485,4342,-5706,8457,-1076,-11648,-8971,13937,8986,11628,5811,-12968,6736,-12686,-23466,11252,4411,-7126,2651,963,11386,491,-17772,14012,-5157,-6111,-5540,8320,12503,-1539,1869,-27384,-3566,-3504,-2306,7234,-6755,7110,-9898,-9070,-3009,13590,-4132,1712,-18242,-15141,-7297,4028,-1535,12740,-7258,16557,1823,-14521,-6776,-734,8315,-5716,7604,-16839,-18184,-18363,5952,-13569,8298,-7730,-6541,-4840,12756,-2763,9057,9827,5736,11121,-8766,-2761,-2780,-1666,-8888,-3232,19595,-10214,-11143,10835,-10498,8406,3625,5148,7067,-4618,-10216,-223,-9956,-2248,2907,5746,-1732,15664,-13536,-2628,-16098,14800,3025,11684,-7183,6951,6883,-1019,-7387,26551,-16699,4939,14164,-14286,-13378,2739,-20681,4611,16040,19267,-9633,-8982,16022,-2948,15800,-7576,3019,2024,11693,1379,-6312,23155,17999,4148,3005,-6809,-8388,9103,10030,22620,-8378,1468,4638,-15767,1733,5559,-3867,-7548,9622,9840,13714,3652,9103,13968,2384,1130,8497,7784,13125,13363,13168,-3255,-15713,3187,9337,3306,-2609,-4820,-873,-3133,-977,-1320,-1299,-7635,-3866,2725,7460,411,414,-2927,26107,10555,-16262,-8632,-8012,-11217,-10542,12653,4760,3072,16273,4556,-11825,15971,3528,13980,8401,8393,-17681,-7177,-8506,5554,6614,4605,-7695,-566,-10296,-7109,-5411,6389,-17644,10869,4359,-15246,9698,1258,5454,10078,-2282,-2921,4129,-22269,2954,-1714,14619,6189,8223,2895,-16948,10891,15089,6613,5484,16499,-13450,1485,14726,10825,-8632,660,-6628,-4308,-5752,-111,-6512,3040,28163,7449,-10881,-930,3300,9335,-1131,-14209,-11098,-2495,5987,8108,-12188,-8066,-18336,5248,-12038,-13751,-23432,-20323,-3607,9829,9622,17698,25901,-3496,7485,276,-8682,-11841,-4413,7069,-4247,-8992,11078,-299,19591,-6185,4811,-23611,13529,-438,-4450,9523,-10513,681,-1056,-4798,12475,2825,-3246,-11626,-5458,-7204,-363,9819,9230,-13211,-12925,12469,-4801,-4843,22891,2874,-761,-1587,-15152,-16,20170,1714,9563,-4755,-11108,880,2787,-10045,9258,-1069,-5813,-3546,2700,14101,2612,-5231,9616,9817,-67,-2780,8690];

pub const KYLEN:usize = 32;
pub const CTLEN:usize = 4000;
/*
const ID: &str = "localhost";
const CSK: [i16; 1024] = [17427,5481,11717,2709,18990,-6238,-17547,2027,4061,-4631,-23,3412,12873,-8107,-1699,6678,-1083,1705,-6004,2774,16557,4366,-10825,10903,1756,6881,-25568,-322,-17991,-13050,8943,7500,7358,10447,7829,6314,-6985,-9464,13680,7832,7106,15844,5551,13145,1950,-12963,3632,6773,-128,8671,17307,2054,3956,-2813,1548,12496,14130,8814,-27578,-3152,-408,-983,-16798,-2807,-11168,219,11395,6367,-9928,-2227,-15149,-507,7877,4774,-6751,6896,-2466,-11105,24353,24179,-3902,25488,-3414,8697,11411,853,-1340,-1297,4458,-15319,3430,-3586,10809,-2748,-7217,6033,6831,-18159,12216,4395,-1343,-1450,-4613,3367,-13378,13129,5442,2509,3152,8105,12764,-6831,6600,-2091,2901,7563,14642,-19547,14228,-12571,10836,4384,15431,-3523,-5408,-1546,-14063,5632,-24408,-27872,-5032,7874,9251,-9140,18705,-8817,-8968,16093,-12684,-1129,-6338,-5697,4893,-5885,-3056,9635,7287,-13307,-7784,3713,-1377,-734,15123,-1801,6724,4171,-11671,5203,7084,-4160,10483,1852,19384,13593,13166,5641,8138,-16547,16902,1112,-6621,-7555,15165,1320,20371,18137,6126,14740,21371,17539,-8372,8527,1770,2705,9349,-5665,-2176,10560,3785,9924,-5357,1208,-19450,-10552,-2090,-1079,-12323,9823,25139,14484,15436,-3052,14406,13746,-8160,-10664,-4265,-7453,-6872,6781,-15771,-1497,-2909,14834,-18087,-13590,-3843,-544,18322,7586,3025,11815,-13969,-14900,1405,-7978,6093,-21992,1881,-2547,12628,4075,834,19042,1403,-905,-13397,-5,-19527,1712,23459,13483,-3476,3356,12249,17258,8353,8105,-3952,-17172,-8404,-790,5649,-15055,-9041,-11029,983,6834,28652,-5093,4886,8837,5515,-1090,-9781,4875,2422,-817,-21674,-1930,-4324,4672,13993,-16685,-4886,-4790,-6134,6371,-821,5939,-2235,-2512,2815,-7837,-15251,-14046,-10248,14277,-8793,-4343,10246,-2302,-9660,-21118,-8149,6277,26173,3432,15103,6285,-7489,-29638,-115,7942,1804,9079,658,5051,-6485,-4237,-21995,-7406,-9505,5514,-6678,8021,-8367,-6990,22168,1723,-2296,10631,7647,-5836,-12666,10618,2984,-11028,-17173,5594,-4342,-1759,5762,-6956,12594,-531,6537,-978,10586,1114,-4752,9331,-1525,-2180,10271,-1773,243,7320,533,1791,-4502,6539,5963,-16519,-1354,-3793,-3347,-19503,-1501,-22213,-8743,10695,-2720,15813,-481,-2703,883,-910,-3096,3492,9343,5903,-10007,1340,131,-14933,22394,-16576,-3805,1933,3223,15998,12066,11904,-12856,13939,-4631,4844,-89,-4798,-9692,-1444,5285,-8968,3751,8432,18677,-2560,-8470,15395,-4829,-8029,5974,-23551,-9051,-6994,-15820,227,-11797,19615,-5912,8078,-13472,-781,8102,3253,-4004,17975,-3340,-2173,3644,14622,8206,-13381,3951,7222,-12626,14391,3153,12489,-12229,-11891,12544,1630,-2324,-2795,361,-12797,905,14805,-5740,8113,-7665,-2401,-6117,15976,8919,5291,4653,21564,-9251,-13751,852,-18317,-5742,-13060,-5225,-6150,-4787,-14565,-3530,-15265,16879,-22087,-16352,724,-6708,10304,6029,19506,14774,-7612,-17372,6290,11876,9281,1659,-12775,3602,8848,5269,6765,-1887,-7459,-3589,-653,-6389,5968,9236,-7762,-11643,5681,4340,-9449,-15397,12826,-8248,10367,1186,3180,-8531,6271,-9565,7304,-6442,6138,13320,8819,-19209,-2200,18585,2849,-13497,11098,-1967,-5841,2528,-11657,17708,14126,10766,19193,-5431,12741,-12181,-8406,5901,12205,-7833,-13666,-10544,-8832,-16072,2052,-14619,2178,13462,-4979,12481,11187,15216,-1316,27502,6074,-13444,-3759,-4750,-1542,-20890,9203,36,20093,15623,-2406,14113,-9608,-2424,12360,-1530,17645,-8374,-22849,9537,7094,7238,1764,8568,-10396,1248,652,11405,9663,-18563,18092,-16995,-29299,-13502,-15856,6506,57,807,18225,-123,-9658,-26877,2774,3995,-5151,58,-2128,7043,-7686,-8682,-11509,5420,382,-380,-8479,-5230,4335,18186,7606,-3748,-4538,-5415,-1249,-14683,4596,-2287,2462,19996,-13523,15675,-4084,3340,-8451,-1177,843,7742,1808,4398,16740,1606,3760,20451,-5674,5473,-483,-7170,-7796,-16740,9839,3027,6775,-1787,-7783,3107,11386,-6385,-4929,18993,-8966,-12178,20079,-3261,-12737,6492,6289,18675,-2891,-6436,-11719,8805,11615,13981,7140,-8288,-17855,-7419,-5714,4503,10451,-29220,-2084,15216,786,-20371,-3129,9848,12923,69,1564,6401,-11150,1135,2828,12101,10556,1998,-2915,-7168,-1453,7894,-1982,-13292,-4847,3540,-15800,-13984,-1963,2656,5148,-15304,-1408,-5476,3665,-717,-10138,14892,-7216,7193,-594,3678,-18363,-18803,-5853,-4513,-9946,2259,-11437,-2254,7272,-3361,-6573,-6156,3154,2777,-11573,955,-1813,-5940,4330,398,-1616,-20264,-8307,14223,-1074,-6932,-113,1344,-8307,-5453,18800,-6226,-2277,5666,-11443,5664,-15298,-18631,-4623,-21167,-1762,-5678,7600,15567,-1363,6905,4515,3657,-219,235,-8394,19344,12922,-1732,3578,2116,-325,6911,11773,-1306,-15541,-6194,1654,-7036,-7735,-11066,-414,2966,-6844,-24037,1471,-12680,-6017,-10792,2458,-18517,954,12084,6097,22793,-20555,-5704,7694,9795,3905,-6888,5199,-12432,-6635,-8461,-8941,22928,-7963,11536,-16628,1354,-1795,19058,1240,3592,3930,-8217,-12032,-7125,-17422,7887,-5139,-1830,16848,6836,1832,15753,-5328,16098,-11480,375,-4555,-10168,13418,-4639,-8470,-1834,-9947,913,13174,8910,-18108,8456,-7721,-19177,-9906,-3819,-4620,-18572,16525,578,2401,-12949,-3160,-2589,-6409,275,-12902,11176,-7696,12130,-5789,3283,607,6536,-11055,-6286,-11870,-6546,-6015,-15335,12779,-8025,545,9700,81,-4931,6640,9330,6368,-4350,10579,2102,-15189,18978,3677,692,-26067,1001,3226,-635,18134,9120,-8060,7276,-642,2261,-5355,-7268,8739,13835,-16022,-11362,6033,-728,1158,-7610,-16001,3160,-3699,10647,-7999,-8004,1844,-2609,-3023,857,-2673,-2481,6715,-21075,-1937,-2255,-4177,-5582,3869,-3341,-11594,7208,-12311,3786,12357,-8477,730,-21769,-1277,-4878,-9327,-13378,7187,-5952,-3224,-10495,-7558,-1633,-7102,-16883,-5727,-7165,5985,4896,6329,10087,10643,15248,7898,13385,-7175,-9475,3024,2447,59,10197,7564,14028,-9173,-2064,2240,-6144,11231,-8078,17785,10980,-13085,4588,813,4962,5845,-5735,6470,10330,6800,11784,201,7110,8304,-1491,-12663,-8343,3356,-170,-2369,-18825,19704,2431,-1560,-5828,5471,4814,-3366,-4769,-8335,-9521,-12535,-2222,15295,1592,-9822,-12471,13742,-10666,-24201,5218,307,12554,-1429,-10966,12164,10734,-1842,10853,-7763,-2342,-1116,-13322,-15520,-9145,12852,-3373,-78,-5848,1136,-4257,-23732,-1950,9114];

const LOOPS: usize = 1000;

fn main() {
    println!("Testing IBE KEM");

    let identity = ID.as_bytes();
    let mut ct:[u8;4000]=[0;4000];
    let mut key:[u8;32]=[0;32];
    let mut key2:[u8;32]=[0;32];
    let mut r32:[u8;32]=[0;32];

    for i in 0..LOOPS {
        for j in 0..32 {
            r32[j]=((i+j)%256) as u8;
        }
        cca_encrypt(identity,&r32,&mut key,&mut ct);
        print!("EK= ");
        for i in 0..32 {
            print!("{},",key[i]);
        }
        println!("");
        cca_decrypt(identity,&CSK,&ct,&mut key2);
        print!("DK= ");
        for i in 0..32 {
            print!("{},",key2[i]);
        }
        println!("");
        for i in 0..32 {
            if key[i]!=key2[i] {
                println!("SCREAM"); break;
            }
        }
    }
}
*/

# Description

This C++ version is really just C plus namespaces. Namespaces are the only feature of C++ that is used. The Rust version will come later.

The starting point was this page https://tls13.ulfheim.net/

The initial idea was to implement two processes, server and client, which implement TLS1.3 over a local socket connection.

We succeeded in reproducing the output down as far as the Application Keys calculation (which is close to the end of the protocol). 
The Crypto support (for hashing, HKDF, and X25519) for now  uses MIRACL Core https://github.com/miracl/core. 

This can be changed later, and other cipher primitive code added later on. For example Lightweight ciphers, post-quantum key exchanges etc.

So far this is just a very bare bones skeleton of an implementation, in no way ready for public scrutiny! So this repository is private for now.

I have it working here on a Windows machine, using WSL2 (Windows Subsystem for Linux).

Having got this working, next up was to complete a TLS1.3 connection with a real TLS1.3 server, in fact tls13.cloudfare.com

To see the demo, first build the C++ version of MIRACL Core, selecting curves C25519 and NIST256, and RSA2048.

Download the contents of this directory to a working directory, and copy into it core.a and the *.h files from the MIRACL Core build. Then

    g++ -O2 client.cpp tls_keys_calc.cpp tls_sockets.cpp tls_hash.cpp tls_scv.cpp tls_cert_chain.cpp tls_parse_octet.cpp core.a -o client

Then execute the client process

The (commented and slightly edited) output should be

	Private key= 0x0f3e3d3c3b3a3938373635343332312f9d155815b664df4bbea56f6b986955a5
	Client Public key= 0x358072d6365880d1aeea329adf9121383851ed21a28e3b75e965d0d2cd166254

	Client Hello= 208 16030100cb010000c70303000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f20e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff000613011302130301000078000000190017000014746c7331332e636c6f7564666c6172652e636f6d000a00080006001d00170018000d00140012040308040401050308050501080606010201003300260024001d0020358072d6365880d1aeea329adf9121383851ed21a28e3b75e965d0d2cd166254002d00020101002b0003020304
	Client Hello sent
	Server Random= 43cb3aba4bd9b08acd797a5dafcafb2da7d162d268f2f84b8df573df5db95208
	Cipher suite= 1301 // TLS_AES_128_GCM_SHA256 0x1301
	Key Share = 001d // X25519
	Server Public Key= ea73ce737073c671e728847b22f183908e5e449e0804d2a6351df2c087da1025
	Server Hello received
	Server Hello= 122 02000076030343cb3aba4bd9b08acd797a5dafcafb2da7d162d268f2f84b8df573df5db9520820e0e1e2e3e4e5e6e7e8e9eaebecedeeeff0f1f2f3f4f5f6f7f8f9fafbfcfdfeff130100002e00330024001d0020ea73ce737073c671e728847b22f183908e5e449e0804d2a6351df2c087da1025002b00020304
	Hash= a9ec6059e62009493d966e93edc86cfe7235e193de2bf18444b00e05bc96909d
	Shared Secret= f36d375c2653cc7898fe440a57f06fc9082003ec995d53cf14eb52cd621ad039
	Handshake Secret= febacdfb3046a89960273be7000fd8db3eda2d7fdee5e233fb56f1afc3c3f813
	Client handshake traffic secret= 04a2a16a21b7f3b664ea748f3e141c841ed595833765bbd9200aa098f16bc15a
	Server handshake traffic secret= 453bae3d099f84a93e290d63ac2e5cb838b97e334fe4104b8b82273a5572346d
	Client handshake key= ae939c43ae928b18e0c1144af91646f5
	Server handshake key= d4bbe00db3062a456e2be6bc9b10a7f0
	Client handshake IV= 21f4fb7cc9b880be1b7260d7
	Server handshake IV= 0bfec48e479f908476f402f3
	TAG= 1d5560fe60f2bcfd9ebbcfc39aa7bd12
	Server response authenticates
	hut1= 2272
	Signature Algorithm= 0403 // ECDSA_SECP256R1_SHA256
	Server Certificate Signature= 71 30450221009881b085bd28e534a681d7fa0b31e6740c27afc1bf231694080c860d90015de4022009d34d28e68d3701c759bc22d46e6af96cc6af81001cc7e151a174257c6c9644
	Server Verify Data= 32 9039d2320a954241a9eeb033a341fca6390c44027e15262a0bd82795d17d3324
	Certificate's ECC SIG= 64
	e36c74c147bbc2afd06d73afc9a617f085ef3914342fefdc38ce13ad50841bd1
	da0f26422861a98be32a7439b274b2289cf9385122aef79fa0bb40903d04e095
	Hashed with SHA256

	EXTRACTED ECC PUBLIC KEY= 0
	041bcc89aca59894f406e89dca80a8ace1778e637fdc2f9a8443e98fdf3825e32962a605fbfd724b890e77eb56fc7c9863fd48c8b9d149d312fd89b3abb3a2530e
	cert.len= 2254, ptr= 1272
	cert.len= 2254, ptr= 2252
	type= 2, hash= 2, curve/len= 2048
	Certificate's RSA SIG= 256
	05241ddd1bb02aeb98d685e3394d5e6b579d8257fcebe831a257906505be1644385a7702b9cf1042c6e192a4e34527f800472c68a8569953548fad9e40c1d00fb6d70d0b38486c502c4990065b641d8bcc48302ede08e29b4922c0920c115e969294d5fc20dc566ce59293bf7a1cc037e3854915fa2be17439180fb7daf3a25758604fcc8e9400fc467b34313e4d4782813acbf4895d0eef4d0d6e9c1b8224dd32255d117851103da03523042f656f9cc1d143d7d01ef331675927dd6bd275099311242414cf29bee623c3b88f723fe907c82444537ab3b96165a14c0ec64800c97563058770455283d3959d45eaf0e8311d7e091f0afe3eddaa3c5e74d2acb1
	Hashed with SHA256

	EXTRACTED ECC PUBLIC KEY= 0
	04b9ad4d6699140b46ec1f81d12a501e9d03152f34127d2d96b888389b855f8fbfbb4def6146c4c973d4244fe0ee1cce6cb351712f6aee4c050977d37262a49bd7
	SIG=
	e36c74c147bbc2afd06d73afc9a617f085ef3914342fefdc38ce13ad50841bd1
	da0f26422861a98be32a7439b274b2289cf9385122aef79fa0bb40903d04e095

	ECC PUBLIC KEY=
	04b9ad4d6699140b46ec1f81d12a501e9d03152f34127d2d96b888389b855f8fbfbb4def6146c4c973d4244fe0ee1cce6cb351712f6aee4c050977d37262a49bd7
	Checking ECC Signature on Cert
	ECP Public Key is Valid
	ECDSA Signature/Verification succeeded
	Intermediate Certificate Chain sig is OK

	Important Certificate Details
	Signature is 05241ddd1bb02aeb98d685e3394d5e6b579d8257fcebe831a257906505be1644385a7702b9cf1042c6e192a4e34527f800472c68a8569953548fad9e40c1d00fb6d70d0b38486c502c4990065b641d8bcc48302ede08e29b4922c0920c115e969294d5fc20dc566ce59293bf7a1cc037e3854915fa2be17439180fb7daf3a25758604fcc8e9400fc467b34313e4d4782813acbf4895d0eef4d0d6e9c1b8224dd32255d117851103da03523042f656f9cc1d143d7d01ef331675927dd6bd275099311242414cf29bee623c3b88f723fe907c82444537ab3b96165a14c0ec64800c97563058770455283d3959d45eaf0e8311d7e091f0afe3eddaa3c5e74d2acb1
	RSA signature of length 2048
	Public key= 04b9ad4d6699140b46ec1f81d12a501e9d03152f34127d2d96b888389b855f8fbfbb4def6146c4c973d4244fe0ee1cce6cb351712f6aee4c050977d37262a49bd7
	ECC public key Curve is SECP256R1
	Issuer is  Baltimore CyberTrust Root
	Subject is Cloudflare Inc ECC CA-3

	Public Key= a304bb22ab983d57e826729ab579d429e2e1e89580b1b0e35b8e2b299a64dfa15dedb009056ddb282ece62a262feb488da12eb38eb219dc0412b01527b8877d31c8fc7bab988b56a09e773e81140a7d1ccca628d2de58f0ba650d2a850c328eaf5ab25878a9a961ca967b83f0cd5f7f952132fc21bd57070f08fc012ca06cb9ae1d9ca337a77d6f8ecb9f16844424813d2c0c2a4ae5e60feb6a605fcb4dd075902d459189863f5a563e0900c7d5db2067af385eaebd403ae5e843e5fff15ed69bcf939367275cf77524df3c9902cb93de5c923533f1f2498215c079929bdc63aece76e863a6b97746333bd681831f0788d76bffc9e8e5d2a86a74d90dc271a39
	type= 2, hash= 2, curve/len= 2048
	SIG=
	05241ddd1bb02aeb98d685e3394d5e6b579d8257fcebe831a257906505be1644385a7702b9cf1042c6e192a4e34527f800472c68a8569953548fad9e40c1d00fb6d70d0b38486c502c4990065b641d8bcc48302ede08e29b4922c0920c115e969294d5fc20dc566ce59293bf7a1cc037e3854915fa2be17439180fb7daf3a25758604fcc8e9400fc467b34313e4d4782813acbf4895d0eef4d0d6e9c1b8224dd32255d117851103da03523042f656f9cc1d143d7d01ef331675927dd6bd275099311242414cf29bee623c3b88f723fe907c82444537ab3b96165a14c0ec64800c97563058770455283d3959d45eaf0e8311d7e091f0afe3eddaa3c5e74d2acb1

	RSA PUBLIC KEY=
	a304bb22ab983d57e826729ab579d429e2e1e89580b1b0e35b8e2b299a64dfa15dedb009056ddb282ece62a262feb488da12eb38eb219dc0412b01527b8877d31c8fc7bab988b56a09e773e81140a7d1ccca628d2de58f0ba650d2a850c328eaf5ab25878a9a961ca967b83f0cd5f7f952132fc21bd57070f08fc012ca06cb9ae1d9ca337a77d6f8ecb9f16844424813d2c0c2a4ae5e60feb6a605fcb4dd075902d459189863f5a563e0900c7d5db2067af385eaebd403ae5e843e5fff15ed69bcf939367275cf77524df3c9902cb93de5c923533f1f2498215c079929bdc63aece76e863a6b97746333bd681831f0788d76bffc9e8e5d2a86a74d90dc271a39
	Checking CA's RSA Signature on Cert
	RSA Signature/Verification succeeded
	Root Certificate sig is OK!!!!
	Certificate Chain is valid
	1. Hash= 9a5f55e665b66733667906e9e2ad0c01d058f19968709430e58b33627d625edb
	2. Hash= 4e93f374271560300e3a06a0f70fe5b83851559138c914f970d0cdf04f3d55e2
	3. Hash= 5c571682cbaa2eaa5da44566484ce5a0e75684e5483629d7dbeedd67e9498129
	Client application traffic secret= 5461a12d244b1589b30a38ab7742c9337805230a84e1aa94b93bd5ae5407708d
	Server application traffic secret= ac9e893f2e177df468e8bd1916c5144dfafed1a471879c6cb577917ac30c38bd
	Client application key= cc15695717580b2d32370a3a45d0003e
	Server application key= e61f767f5be0b9f3055c5963f6e19374
	Client application IV= 8828423d5d9c4698347a87b9
	Server application IV= 0bc6fa6f3d2ffe4a1d931789
	Server Cert Verification OK
	Data is verified



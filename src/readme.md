# Description

This C++ version is really just C plus namespaces. Namespaces are the only feature of C++ that is used. The Rust version will come later.

First inside a working deirectory build the C++ version of MIRACL core (https://github.com/miracl/core), selecting support for C25519, NIST256, NIST384, RSA2048 and RSA4096.

This library does all the crypto, and can be regarded as a "placeholder" as we may in the future replace its functionality from other sources.

Then copy the contents of this archive to the same directory, in particular client.cpp and tls*.*

Build the client app by 

	g++ -O2 client.cpp tls_keys_calc.cpp tls_sockets.cpp tls_hash.cpp tls_scv.cpp tls_cert_chain.cpp tls_parse_octet.cpp tls_client_recv.cpp tls_client_send.cpp core.a -o client

Then execute the client process as for example

	client mail.protonmail.com

The (commented and slightly edited) output should look something like

	Hostname= mail.protonmail.com
	ip= 185.70.41.130
	Private key= 0x0d45371230bd6d8bc71a5b25e4772c140aa3fa4b1fdd79e694dabf32cdbef2bc
	Client Public key= 0x9024ca7ec6ac1a386b09972be14973b80d44ef3d6f87b24b4825841f54f6b941
	Client to Server -> 16030100c6010000c2030360b2644314e4cc69802b2b7c3650fdd9ce9e660a7ad9a0136c81e129243d690c20e9eac225d1322292dcc26bd9db8e2bf69ae339d53aedc89c3d11502feb0ba174000413011302010000750000001800160000136d61696c2e70726f746f6e6d61696c2e636f6d000a00080006001d00170018000d0012001004030804040105030805050108060601003300260024001d00209024ca7ec6ac1a386b09972be14973b80d44ef3d6f87b24b4825841f54f6b941002d00020101002b0003020304
	Client Hello sent
	Server Random= bc3e10ee0ee3ced020bbdede5ff9c98d1d69afb8a33f355f7109f8a6e51446d5
	Cipher suite= 1302
	Key Share = 001d
	Server Public Key= d157e847e6946f5d01808e740e8adb7af0645f5c6ed393353bcbe7112b78d374
	Server Hello= 122 020000760303bc3e10ee0ee3ced020bbdede5ff9c98d1d69afb8a33f355f7109f8a6e51446d520e9eac225d1322292dcc26bd9db8e2bf69ae339d53aedc89c3d11502feb0ba174130200002e002b0002030400330024001d0020d157e847e6946f5d01808e740e8adb7af0645f5c6ed393353bcbe7112b78d374
	X25519 Key Exchange
	Shared Secret= ae9a9b81358cfbc2029d94fa08cc921d37ce5862fa2900171697a684555d125e

	Handshake Secret= c46798e75a0b32bdbdcfca1838caa9f25d3726bb674ec6c30493da2ed87eba942580982dd9179584b0f531f137f7ce5c
	Client handshake traffic secret= d7a99a3bcc844219299b11671fa564ca275d3c4aecd27b9eac6005aea6fbfb94be7a4a355dce5a816eeed7c9cade71db
	Server handshake traffic secret= b754cdf8a6f7f51fd962b873109c489c8c3cba5963ebe24e0aae4f00339a1ad839f9ef45a2369ce6b1582c885bf4ec77
	Client handshake key= ab0e6b0dbd0e9416654ccc02c9f09414b156ab91b2d48b7a312814eab1a94848
	Server handshake key= 27a73b7b433a51199e82690a1b94c692a6e3225c9a3ec4a6f0c4c11685aafead
	Client handshake IV= 6d9f3cf52c4b53e06545f17a
	Server handshake IV= 611889070549e4826be85690
	Server fragment authenticates 11
	Length of Encrypted Extension= 6
	Server fragment authenticates 4468
	1. Transcript Hash= 450b0fce4062376e407d9f67595b0ac59c13d11f67c5c7e9fae4152c944e411ff9f2859e72f0160dfff4fad2e4d0d4f3

	Server certificate
	Signature is aa5e32911a921beada411b7cbb41618006986082432d5356b2b0605a23a652fde14dfc8984286e2ae2641f84037007b6841322b669cb5ae2a193ccf23d565a98819636a353ed3ba6c19ef65395f83855af241f81bd7c20079adf468c7bbbd71c15bc6777786bc6efc9c045e2895f9e176fdf52e095b14c9cf46fdc5ca9ece1ebd2b72d91f45c09cae00aaa199814670b63595493b2bb4053e7d14fd63aec3eb2936165a8e7839a11034c82972945d02989d8206f676d1bcf5b0791420fbf605b717aa1ddd7bcece9fa6515da4f89d04f36b8a2d575f4ae22752c90907de93c46f5a1ca9da7d8bde4634cfefaa16b3d38c46c5398bb9d77f23f9c575b5a88d5fa
	RSA signature of length 2048
	Public key= 512 c8629daafe74555500468234df387c619792bf9d84720c1964b2b4be04c34a69a8afd5780d1272ea06149c5fca0ef262aadd15a0038e66bf1306d703ad2dd9aa5381f6a3e6e8f2b481f8844458edc5a4d1439de2b62ccb12597c2d76637b22dee4d328a5a4711cef4d8b6f4a53d62d08c887afc51a43415ebc6447c46319ba2cf07d0beba104e6a919093ad3feb9cb09f1e00b65211aabdb59ce7f8719c3951b84909655bdb0e23aaa2a0328f27fd5a69383035240e57218a6f550d4417b6ee08b26d922da3ae4ac7a5428eef64d4eac5c0e36113a4164f48fc5b1982a837bb837c9538eb378ab0ec5676b625b9970da94d3a42f34df7b977bd0b9a15b3dfedc9bda2464df4d100f93fbcf45b9182d2b85ebe6a06b459d3655ddfdfd817c3de0e4c797e39ac22590edbec86fe70c7fdb078ad0fa0f372eb0d56be7cad26757adb65131bb9added44af4713700b6949034f1a367972c73c5387d2e8b3c9c6537e56d8e0f7859caaa174cd4167871bc8f034fcfabc55637655eb027e93bb94dc1387b997f4d3c64e2e314e6037d3e494052d515c00581b0ed3ebf85b97b15107a7e36848859b9f1f7d283678e1a8c597c4d26c46ea5755f6dde13c232781de6b185590e48555de9777937154c91a1e675ee711e8451608f81aec36e4376a581b9cdff39cf3a109954cc77e66dc332e6014ad33ab400c6d2bb3893dc051ff6dbda7
	RSA public key of length 4096
	Issuer is  SwissSign EV Gold CA 2014 - G22
	Subject is protonmail.com

	st.curve= 2048
	SIG= 256
	aa5e32911a921beada411b7cbb41618006986082432d5356b2b0605a23a652fde14dfc8984286e2ae2641f84037007b6841322b669cb5ae2a193ccf23d565a98819636a353ed3ba6c19ef65395f83855af241f81bd7c20079adf468c7bbbd71c15bc6777786bc6efc9c045e2895f9e176fdf52e095b14c9cf46fdc5ca9ece1ebd2b72d91f45c09cae00aaa199814670b63595493b2bb4053e7d14fd63aec3eb2936165a8e7839a11034c82972945d02989d8206f676d1bcf5b0791420fbf605b717aa1ddd7bcece9fa6515da4f89d04f36b8a2d575f4ae22752c90907de93c46f5a1ca9da7d8bde4634cfefaa16b3d38c46c5398bb9d77f23f9c575b5a88d5fa

	RSA PUBLIC KEY= 256
	bf8c56ed74921d39e4c50892945a0bbb1f8ae150e2001816fe01e4b7ec2ba352a53689c9b62fac0fe5af424113fc53b1097726b91aeb4160a6b4a1f695e013de1456813641be0b887128008632050634680de72fd184913e37eae5ecd2d57655e83afba0a0191ce06a842d0eede15d657918ec8d380b659b347899dd491faa056a9f5dde457024b131508f77d02c23cf0b745c072f8f2f3e7cb85e05a9c6e551469d1ae7b51496891cd84088e30240434e2fa58f9e7687d68acc5bc5110e4d4a2066ac6564db0225ae1f8065ef0d6275eb441cefd19e523830f88f1c8f913017edff73909f6cd323151266a55a77f05e7e0ae11cf7c7b7e659ecb18a950e8529
	Checking RSA Signature on Cert 32
	RSA Signature/Verification succeeded
	Intermediate Certificate Chain sig is OK

	Intermediate Certificate
	Signature is 25718548309ec159804982e74702304c5c9af63d39090fc5c41b30c14262f7ef045373eb98aed0c9174e8d2385a21ef3038eb2fdb7d2aff36096d364e19b329bd48393114482bd0c2ab76c3c00a8df5b223170c0ad5b383b76eb49bdfb880bc4925db76307e4b020950d89d35db7f91a1d631befddbfb993afc3675f5d254817ae36c3fb43d6b8ee7ee4345a9e0a775442c84568c70009e99aade0b8e4622ee5434be3e88a7169fc2284151860588869eac65dc80ffd7a03be647f94ecaccb68cb9844d1df26bd94ae041412e7ec38cd1652a4174bc4733bb6465bf6ab81fc9ce0d7520a2bcef7bc5906ba0e3745da2ce9530006ee6e89a1cf3fcafd4bf64b94fe23f01f6160a67bb571fcac9e03d89ffde2c08d0367e6521bd5c5e1a26a4cd8cfa42c01a336176942f51292302128e933a1e7b324437e4575383f9b4e271c34dcbb4957199d431430817391d2b0594fef5a149497d67223ef35919ccc05bb9c3e801697d7fe4cb8b3ff4e1242724a1581bd289db14b467eac887e9d344fa067956088c59e0ce930951d5431618c370a0a344c684ca6302a7a6e31fbf8abb171e2e23da95cc64cbeb27d6f3e49177154541ae8af617a406bda467200a042ab3fa3a50ab510f09cbe7e0788dc7cd4d6befa2a9e2be77699f671744b80c05a1921cca4d5a4d61c74f50aacf2b34d3096e92f4a69d75016c6539569c338e58f7378
	RSA signature of length 4096
	Public key= 256 bf8c56ed74921d39e4c50892945a0bbb1f8ae150e2001816fe01e4b7ec2ba352a53689c9b62fac0fe5af424113fc53b1097726b91aeb4160a6b4a1f695e013de1456813641be0b887128008632050634680de72fd184913e37eae5ecd2d57655e83afba0a0191ce06a842d0eede15d657918ec8d380b659b347899dd491faa056a9f5dde457024b131508f77d02c23cf0b745c072f8f2f3e7cb85e05a9c6e551469d1ae7b51496891cd84088e30240434e2fa58f9e7687d68acc5bc5110e4d4a2066ac6564db0225ae1f8065ef0d6275eb441cefd19e523830f88f1c8f913017edff73909f6cd323151266a55a77f05e7e0ae11cf7c7b7e659ecb18a950e8529
	RSA public key of length 2048
	Issuer is  SwissSign Gold CA - G2
	Subject is SwissSign EV Gold CA 2014 - G22


	Public Key from root CA cert= afe4ee7e8b240e126ea9502d16443b92925ccab85d849242132abc655782403e5724cd508b252ab76ffcefa2d0c01f02244a13968f2313e6285800a347c706a784232bbbbd962b7f55cc8bc1571f0e62650fdd3d568a73daae7e6dba811c7e428c2035d9434d84fa84db522cf30e27770b6bbf112f72789f2ed83ee618375a2a72f9da62909295ca1f9ce9b33c2bcbf30113bf5acfc1b50a60bdddb5996453b8a096b36fe22677918ce06210029f340fa4d5923351debe8dba847a603c6adb9f2becdede013f6e4de55086cbb4afed4440c5ca5a8cdad22b7ca8eebea6e50aaa0ea5df0552b755c7225d326a97976313dbc9db79367b853a4ac55289f924e79d77a982ff551ca571692bd10224f2b326d46bda0455e5c10ac76d3037902ae49e14335e161755c55bb5cb348992f19d268fa107d4c6b27850db0c0c0b7c0b8c41d7b9e9dd8c88f7a34db232ccd817dacdb7ce669dd4fd5effbd973e2975e77ea76258af2534a541c73dbc0d50ca03030f085a1f95737862bfaf7214690ea5e5030e788e262842f0070b622010673946faa903cc04387a66ef2083b58c4a568e9100fc8e5c82de88a0c3e2686e7d8def3cdd65f45dac51ef2480aeaa56976ff9ad7dda613f98773ca591b61c8c26da65a2096dc1e254e3b9ca4c4c808f777b609a1edfb6f2481e0eba4e546d98e0e1a21aa27750cfc46392ec47199debe66bcec1
	st.curve= 4096
	SIG= 512
	25718548309ec159804982e74702304c5c9af63d39090fc5c41b30c14262f7ef045373eb98aed0c9174e8d2385a21ef3038eb2fdb7d2aff36096d364e19b329bd48393114482bd0c2ab76c3c00a8df5b223170c0ad5b383b76eb49bdfb880bc4925db76307e4b020950d89d35db7f91a1d631befddbfb993afc3675f5d254817ae36c3fb43d6b8ee7ee4345a9e0a775442c84568c70009e99aade0b8e4622ee5434be3e88a7169fc2284151860588869eac65dc80ffd7a03be647f94ecaccb68cb9844d1df26bd94ae041412e7ec38cd1652a4174bc4733bb6465bf6ab81fc9ce0d7520a2bcef7bc5906ba0e3745da2ce9530006ee6e89a1cf3fcafd4bf64b94fe23f01f6160a67bb571fcac9e03d89ffde2c08d0367e6521bd5c5e1a26a4cd8cfa42c01a336176942f51292302128e933a1e7b324437e4575383f9b4e271c34dcbb4957199d431430817391d2b0594fef5a149497d67223ef35919ccc05bb9c3e801697d7fe4cb8b3ff4e1242724a1581bd289db14b467eac887e9d344fa067956088c59e0ce930951d5431618c370a0a344c684ca6302a7a6e31fbf8abb171e2e23da95cc64cbeb27d6f3e49177154541ae8af617a406bda467200a042ab3fa3a50ab510f09cbe7e0788dc7cd4d6befa2a9e2be77699f671744b80c05a1921cca4d5a4d61c74f50aacf2b34d3096e92f4a69d75016c6539569c338e58f7378

	RSA PUBLIC KEY= 512
	afe4ee7e8b240e126ea9502d16443b92925ccab85d849242132abc655782403e5724cd508b252ab76ffcefa2d0c01f02244a13968f2313e6285800a347c706a784232bbbbd962b7f55cc8bc1571f0e62650fdd3d568a73daae7e6dba811c7e428c2035d9434d84fa84db522cf30e27770b6bbf112f72789f2ed83ee618375a2a72f9da62909295ca1f9ce9b33c2bcbf30113bf5acfc1b50a60bdddb5996453b8a096b36fe22677918ce06210029f340fa4d5923351debe8dba847a603c6adb9f2becdede013f6e4de55086cbb4afed4440c5ca5a8cdad22b7ca8eebea6e50aaa0ea5df0552b755c7225d326a97976313dbc9db79367b853a4ac55289f924e79d77a982ff551ca571692bd10224f2b326d46bda0455e5c10ac76d3037902ae49e14335e161755c55bb5cb348992f19d268fa107d4c6b27850db0c0c0b7c0b8c41d7b9e9dd8c88f7a34db232ccd817dacdb7ce669dd4fd5effbd973e2975e77ea76258af2534a541c73dbc0d50ca03030f085a1f95737862bfaf7214690ea5e5030e788e262842f0070b622010673946faa903cc04387a66ef2083b58c4a568e9100fc8e5c82de88a0c3e2686e7d8def3cdd65f45dac51ef2480aeaa56976ff9ad7dda613f98773ca591b61c8c26da65a2096dc1e254e3b9ca4c4c808f777b609a1edfb6f2481e0eba4e546d98e0e1a21aa27750cfc46392ec47199debe66bcec1
	Checking RSA Signature on Cert 32
	RSA Signature/Verification succeeded
	Root Certificate sig is OK!!!!
	Certificate Chain is valid
	Server fragment authenticates 521
	2. Transcript Hash= 57a965533ad8618842a3aaec76ab88c0c94412791a88c51d5a1950e10aa8c9e8c694be9142ac43e170112d9a9a9f9dc4
	Signature Algorithm= 0804
	Server Certificate Signature= 512 55ea1dff16297686dd740541a00bdd5c5a235ce234ba789abe142519aaefb58fa1d181579383b936caa956b65e76e31221c746ee04c6348de0bc76bb4492221d3d2099f0eff14bed5792aed3fc7c99389d19e21738f5ab6c119f89709d073ec18e456cd759433d806acc6588aebd3eeec7d5620cb93f17e59205756faf02439015cd8818dc0978af503f5f71dac5d7b63e952fb1cc34698c269f04fc1e929a20e4650dcaa51efc071c37e040c837b483c615f12289e19cbecbc70c4172e26d18b8232d410445aa393c34b6de409c47dfb3fbab8b5642ac919a3194fce67f04d99faaa7b201f676c83996f7a6afa61bb897bded7e56f73ea0f94d72f95c02bd36e2e3348c802dfdb4a538b5ed03b13d0aba023b59b114d275239669fad124b423e318fe24df21611e8993f4632628f5a2bd308bd0fde24e4fe8cd9e8d49187082b492de5f43a7ef01e7005d8823ccdbfda8a2c9398f12ecaf830d124e396583ee66096f7487049d7b3302356a2c69f3cb5a766d3f807532ba82fd1108795831c1738a5c0a02372ed6642349eb31e73ae25e1448428026e9a4d039d9a1ee79ef67b112a2b22cf442e9e99adc8140766361b0d277349c47a405a42df01f5ebc215ffad01ed3dfb21e200b48526baf160476267936aa47b034cfd2f9332638bec86a1ca2cd5e630d8d7d061e5ec8cf1a232820c45cbc698fd69bd4c35dd4e9bb7bd7
	Server Cert Verification OK
	Server fragment authenticates 53
	3. Transcript Hash= 8e9fa948043c578ee18c624c3db723f681440056392380ac7647fa3f88d98798d69ce458b4f3da59f3acfc0a7c710680
	Server Data is verified
	Client Verify Data= 96c4d621fe0c2afd886caa2b256968bd77e510c602137fef61f4fa3ac1dea92f91e270fe09075620a905941c4004d49c
	Client to Server -> 170303004562328720197a0d655d876fa571b8031876f18282594943162205d343576925f7854849de4c998132d22ae652320f7a440035041ec5a012e5528f20e0709513df11f9426842
	Client application traffic secret= b8b2080e995a9fcb4302855f9cdffdb51c5ad56433d85ac20c175a14c8e84cec6379c5916ba786d0aa0c540e0776a193
	Server application traffic secret= d086402e7bc272d0a6907d7011091675fa31c9214aa3087132610b1eeca7eba95835e6e1aa673505838823301fb83e26
	Client application key= 469b848112ec7528dfeab358cf9131690f991a3f564f63b0fe57d34319c90170
	Server application key= 5685718b4e0eccfff4a78d596d4b18ed0feca96da64c84505d1bd47485294634
	Client application IV= 158def22be9331e5f0b57f90
	Server application IV= ae535e67853cda3d83ef6233
	Sending Application Message

	GET / HTTP/1.1
	Host: mail.protonmail.com

	Client to Server -> 170303003e5f50e6527295a3c0277dcdc4cb2d479f724edf6d02d6a577696b917ad23d34fe2b8cc7d9c360e30a47e23742a7e8e6899436e1491953f0421e8054c5db94
	Waiting for Server input
	Server fragment authenticates 58
	life time t= 7200 age obfuscator = -620436316
	Nonce = 0000000000000000
	Ticket = b4d18352d313413894b459b24b329c7c66942236edb124b23845d8fa70f33782
	Waiting for Server input
	Server fragment authenticates 58
	life time t= 7200 age obfuscator = -1995895529
	Nonce = 0000000000000001
	Ticket = 5b41f05450514a4cdaab27fb481b29449c42ff2b3ebe106c78cbecd5099fe617
	Waiting for Server input
	Server fragment authenticates 4878
	Application data (truncated HTML) = 485454502f312e3120323030204f4b0d0a646174653a205765642c203036204a616e203230323120
	Waiting for Server input

Try it out on your favourite websites. It will abort if TLS1.3 is not supported. 
At this stage the tool is still quite fragile (only tested and debuggd aginst a dozen websites or so!), and would be expected to often fail.

In particular try

	./client tls13.1d.pw

Try it a few times - it randomly asks for a HelloRetryRequest and a Key Update, testing this code
